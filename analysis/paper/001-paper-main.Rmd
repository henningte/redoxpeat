---
# Choose from this list of Journals:
# JGR: Atmospheres, JGR: Biogeosciences, JGR: Earth Surface, 
# JGR: Oceans, JGR: Planets, JGR: Solid Earth, JGR: Space Physics, 
# Global Biogeochemical Cycles, Geophysical Research Letters, 
# Paleoceanography and Paleoclimatology, Radio Science, Reviews of Geophysics, 
# Tectonics, Space Weather, Water Resources Research, Geochemistry, Geophysics, 
# Geosystems, Journal of Advances in Modeling Earth Systems (JAMES),
# Earth's Future, Earth and Space Science, Geohealth
journal: "Global Biogeochemical Cycles"
# Use draft to submit a paper
classoption: "draft,linenumbers"
# A title should be specific, informative, and brief. Use
# abbreviations only if they are defined in the abstract. Titles that
# start with general keywords then specific terms are optimized in
# searches
title: "Electrochemical Properties of Peat Particulate Organic Matter on a Global Scale: Relation to Peat Chemistry and Degree of Decomposition"
# First name or initial followed by last name
# Authors are individuals who have significantly contributed to the
# research and preparation of the article. Group authors are allowed, if
# each author in the group is separately identified in an appendix.
# Additional author notes should be indicated with
authors:
  - name: Henning Teickner
    email: "henning.teickner@uni-muenster.de"
    affil: 1
  - name: Chuanyu Gao
    affil: "1, 2"
    footnote: 1
  - name: Klaus-Holger Knorr
    affil: 1
affiliations:
  - number: 1
    name: ILÖK, Ecohydrology and Biogeochemistry Group, University of Münster, Heisenbergstr. 2, 48149 Münster, Germany
  - number: 2
    name: Key Laboratory of Wetland Ecology and Environment, Northeast Institute of Geography and Agroecology, Chinese Academy of Sciences, Shengbei Street 4888, 130102, Changchun, China
# More than one corresponding author is allowed in this LaTeX file and for
# publication; but only one corresponding author is allowed in our editorial system.
corresponding_author:
  - name: Klaus-Holger Knorr
    email: klaus-holger.knorr@uni-muenster.de
  - name: "Chuanyu Gao (Co-corresponding author)"
    email: gaochuanyu@iga.ac.cn
keypoints:  
  - "Peat particulate electron accepting and donating capacities are smaller than for humic substances and dissolved organic matter"
  - "Both capacities are small in highly decomposed peat, unless there is a large amount of quinones and phenols"
  - "We explain these patterns with parent vegetation chemistry and conditions during decomposition"
abstract:  |
   Methane formation in peatlands is controlled by the availability of electron acceptors for microbial respiration, including peat dissolved (DOM) and particulate organic matter (POM). These electrochemical properties are determined by peat chemistry and both are controlled by decomposition and are thus susceptible to climatic changes or permafrost thaw. Despite the much larger mass of POM in peat, knowledge on the ranges of its electron transfer capacities (electron accepting capacity – EAC, and electron donating capacity – EDC) is scarce in comparison to DOM and humic substances (HS). Moreover, it is unclear how peat POM chemistry relates to its EAC and EDC and how decomposition changes both. To answer these questions, we compiled samples from mid to high latitude peatlands across the world and analyzed their EAC$_\text{POM}$ and EDC$_\text{POM}$, element ratios, decomposition indicators, and relative amounts of molecular structures as derived from mid infrared spectra. Peat EAC$_\text{POM}$ and EDC$_\text{POM}$ are smaller than EAC and EDC of DOM and HS and are highly variable within and between sites. Both are small in highly decomposed peat, unless there is a large amount of quinones and phenols. Element ratio-based models failed to predict EAC$_\text{POM}$ and EDC$_\text{POM}$, but MIRS-based models can predict peat EAC$_\text{POM}$ to a large extent, but not EDC$_\text{POM}$. We hypothesize a conceptual model that describes how vegetation chemistry and decomposition control polymeric phenol and quinone contents as drivers of peat electrochemical properties.
plain_language_summary: "Peatlands accumulated large amounts of Carbon via photosynthesis and slow decomposition of senesced plant material. Microorganisms within the peat form methane. For this reason, peatlands are important global sources of the greenhouse gas methane and therefore can contribute to climate change. In order to produce methane, the microorganisms have to transfer electrons between compounds in respiration processes. Only recently, it has been found that the peat itself can transfer electrons and that its capacities to accept (electron accepting capacity, EAC) and donate (electron donating capacity, EDC) electrons are large. We investigated which conditions favour large or low EAC and EDC of peat so that we can better explain methane formation. We argue that vegetation and decompsition control the amount of phenols and quinones --- molecules in the peat that probably are responsible for most of the peat's EAC and EDC. The EAC and EDC probably are largest for peat formed from vegetation rich in quinones and phenols, such as shrubs, and smaller for other vegetation types, e.g. certain mosses. Intense decomposition may reduce both the EAC and EDC."
keywords: "peat chemistry, electron accepting capacity, electron donating capacity, particulate organic matter, decomposition, mid infrared spectroscopy"
output: 
    rticles::agu_article:
       number_sections: yes
       keep_tex: true
       includes:
          in_header: "000-preamble.tex"
       dev: cairo_pdf
# bibliography: references.bib
header-includes: 
      - \usepackage{soulutf8}  # For UTF8 chars in TrackChanges
      - \usepackage{xr}
      - \externaldocument[si-]{006-paper-supplementary}
      - \usepackage{multibib}
      - \newcites{si}{References for the Supporting Information}
# AGU recommends using the trackchanges LaTeX package in the edition process
# which is available from this link:
# https://publications.agu.org/files/2019/02/January-14-2019-latex-templates.zip
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      fig.align = "center", 
                      message = FALSE, 
                      warning = FALSE, 
                      fig.pos = "H")
```

```{r packages}
# packages
library(ggplot2)
library(cowplot)
library(redoxpeat)
library(magrittr)
library(tidyr)
library(purrr)
library(dplyr)
library(stringr)
library(quantities)
library(errors)
library(units)
library(ir)
library(irpeat)
library(bayesplot)
library(rstan)
library(rstanarm)
library(projpred)
library(kableExtra)
library(knitr)
library(elco)
library(sf)
library(rgeos)
library(rnaturalearth)
library(rnaturalearthdata)
library(bib2df)

# plot theme
ggplot2::theme_set(ggplot2::theme_classic() + 
                     ggplot2::theme(strip.background = ggplot2::element_rect(fill = "lightgrey", colour = NA)))
```

# Introduction

Mid to high-latitude peatlands are important actors in the global carbon cycle with differential effects on the global climate [@Frolking.2011]. On the one side, they accumulated large amounts of atmospheric carbon dioxide (CO$_2$) in the form of peat [@Limpens.2008], on the other side they are sources of methane (CH$_4$) emissions to the atmosphere [@Limpens.2008; @Frolking.2011].  
Methane has 28 to 34 times the 100-year global warming potential of CO$_2$ and therefore may be an important driver of climate warming [@Myhre.2013]. Methane emissions from peatlands increase with higher water table depths, larger temperatures, and increased availability of labile organic matter (OM) [@Moore.1989; @Yavitt.1997; @Limpens.2008]. Even though net C balances of global peatlands may be positive in the nearer future [@Chaudhary.2020], permafrost thaw and peat subsidence under warmer temperatures may favor such conditions and hence  large CH$_4$ emissions [@Anisimov.2007; @Koven.2011; @Frolking.2011]. For this reason, it is important to refine our understanding of controls on CH$_4$ formation in peatlands.  
Methane formation is an obligatory anaerobic process and thus occurs only in the (at least temporally) anoxic zone of peatlands [@Limpens.2008]. It can be suppressed if thermodynamically more favorable terminal electron acceptors (TEA), such as nitrate, iron oxides, sulfate, or organic molecules, are available [@Blodau.2011; @Klupfel.2014; @Gao.2019]. Albeit inorganic TEAs typically have a comparatively small abundance in peatlands, suppression of CH$_4$ formation can occur due to the large abundance of organic matter (OM) that acts as TEA [@Gao.2019] and can be "recharged" even during short oxic periods [@Klupfel.2014; @Lau.2016; @Walpen.2018b]. Whereas dissolved organic matter (DOM) acts as electron mediator during such respiration processes [@Lau.2016; @Gao.2019], particulate organic matter (POM) provides the main part of the EAC of peat and can continuously reoxidize DOM mediators and other TEAs [@Gao.2019; @Blodau.2007]. Consequently, understanding the electrochemical properties of peat POM and how these are driven by vegetation chemistry and decomposition are key to understand CH$_4$ emissions from peatlands.  
How OM chemistry controls its capacity to accept electrons (electron accepting capacity, EAC) or donate electrons (electron donating capacity, EDC) has been analyzed mainly for DOM [@Ratasuk.2007; @Aeschbacher.2010; @Aeschbacher.2012; @Fimmen.2007; @HernandezMontoya.2012; @Tan.2017; @Walpen.2018; @LaCroix.2020]. The positive relation of the EAC to the C:H ratio and the EAC and EDC to indicators for aromaticity have been attributed to quinones and phenols representing the main contributors to the EAC and EDC, respectively [@Aeschbacher.2010; @Tan.2017]. In addition, sulfur and nitrogen containing functional groups can contribute to the EAC and EDC [@Fimmen.2007; @Ratasuk.2007; @HernandezMontoya.2012] and the specific configuration of substituents and the degree of condensation control the magnitude and reversibility of the redox reactions [@Ratasuk.2007; @Uchimiya.2009]. Overall, there is a quite detailed conceptual understanding, which molecular structures are related to the EAC and EDC of HS and DOM.  
In contrast, knowledge on peat POM EAC and EDC (EAC\textsubscript{POM} and EDC\textsubscript{POM}) and even more on how peat POM chemistry relates to its EAC and EDC is still scarce. Few studies analyzed the EAC and EDC of POM [@Keller.2013; @Lau.2015; @Lau.2016; @Gao.2019]. These studies focused on quantifying and analyzing the reversibility of the electron transfer, but not how POM chemistry relates to its electrochemical properties [@Keller.2013; @Lau.2015; @Lau.2016; @Gao.2019]. However, the ranges of the EAC\textsubscript{POM} and EDC\textsubscript{POM} for peat POM are not sufficiently quantified yet. Furthermore, since POM has different chemical properties than DOM [@Worrall.2017], it is unclear if POM electrochemical properties correlate in the same way to element ratios or molecular structures as for DOM.  
"Classical" indicators of peat chemistry, such as element ratios and the nominal oxidation state of carbon (C$_\text{OX}$), tools such as van-Krevelen diagrams to interpret contribution of different OM fractions, e.g. lignin or polysaccharides [@Kim.2003], and mid infrared spectroscopy are promising techniques to explore how peat POM chemistry relates to its EAC and EDC. These methods have been widely used to analyze peat chemistry and to analyze electrochemical properties of DOM and HS [@Worrall.2017; @Leifeld.2012; @Bader.2018; @Moore.2018; @Leifeld.2020; @Cocozza.2003; @Artz.2008; @Hodgkins.2018; @Tfaily.2014; @Aeschbacher.2010; @Aeschbacher.2012; @Tan.2017; @Lv.2018; @LaCroix.2020]. This would enable linking information on different OM fractions and knowledge about assignments of molecular structures to mid infrared variables with the EAC and EDC.  
Similarly unexplored are the relations between the degree of decomposition of peat and its EAC\textsubscript{POM} and EDC\textsubscript{POM}. Since decomposition can considerably transform peat POM and its molecular structures [@Cocozza.2003], it can have large effects on its EAC\textsubscript{POM} and EDC\textsubscript{POM}. Developing a conceptual understanding of these relations is therefore important to understand the mechanics of EAC\textsubscript{POM} and EDC\textsubscript{POM} changes during decomposition. Indicators of peat chemistry, e.g. the N:C ratio (alternatively C:N) [@Biester.2014], C$_\text{OX}$, and MIRS-derived humification indices [@Broder.2012] have been widely used to analyze the degree of decomposition of peat [@Biester.2014; @Drollinger.2020].  
A practically useful product of such investigations may be the development of regression models to predict peat EAC\textsubscript{POM} and EDC\textsubscript{POM} from such indicators of peat chemistry or MIRS. For HS, a close relation between the EAC and H:C ratio was found [@Aeschbacher.2010; @Tan.2017]. MIRS has not been used for the prediction of electrochemical properties of OM, but has proven useful for its qualitative analysis [@HernandezMontoya.2012; @Yuan.2018] and the prediction of other peat properties [@Hodgkins.2018; @Artz.2008].
On the one side, such regression models may enable to infer the EAC\textsubscript{POM} and EDC\textsubscript{POM} of peat samples of existing data, on the other side, they may serve at least as qualitative and (particularly for MIRS-based models) fast and cost effective screening tools which could assist in mapping peat EAC\textsubscript{POM} and EDC\textsubscript{POM}.  
To synthesize, knowledge on the relation of peat EAC\textsubscript{POM} and EDC\textsubscript{POM} to its chemical properties and degree of decomposition is scarce. We thus were interested in investigating how peat chemistry relates to its EAC\textsubscript{POM} and EDC\textsubscript{POM}, and how decomposition may change both. Moreover, we wanted to assess if peat EAC\textsubscript{POM} and EDC\textsubscript{POM} may be predicted from simple indicators of peat chemistry or MIRS. 
To this end, we aimed to (1) quantify the EAC\textsubscript{POM} and EDC\textsubscript{POM} of peat material formed under various environmental conditions and with a range of degrees of decomposition under standardized conditions, (2) analyze the relation of the EAC\textsubscript{POM} and EDC\textsubscript{POM} to bulk chemical properties, indicators for decomposition, and molecular structures, and (3) evaluate if element ratios (H:C, O:C, N:C, S:C) and MIRS can be used to predict peat EAC\textsubscript{POM} and EDC\textsubscript{POM}, all based on a global data set of peat materials.  
These analyses represent a basis for the conceptual understanding of how peat chemistry and decomposition affect the EAC\textsubscript{POM} and EDC\textsubscript{POM}. This knowledge can help understanding, quantifying, and predicting spatiotemporal variability in peat EAC\textsubscript{POM} and EDC\textsubscript{POM} and thus contribute to the quantitative understanding of peatland decomposition processes and CH$_4$ formation on a global scale. With this, we aim to contribute information to better understand and predict peatland-climate interactions.

# Materials and methods

To answer our main research question --- how peat chemistry relates to its EAC and EDC, and how decomposition may change both --- we compiled peat material and data for peatland sites with a broad range of climate regimes, dominant vegetation, and peatland types and performed various measurements under standardized conditions to describe their chemical and electrochemical characteristics. With this data, we conducted an explorative analysis, computed regression models that predict the EAC\textsubscript{POM} and EDC\textsubscript{POM} from element ratios or MIRS, and finally developed a conceptual model how initial peat chemistry and decomposition change chemical characteristics and the EAC\textsubscript{POM} and EDC\textsubscript{POM} of peat.

```{r data-import}
## data import

# samples for this study
d <- redoxpeat::d
d_sites <- redoxpeat::d_sites
d_irms <- redoxpeat::d_irms
d_xrf <- redoxpeat::d_xrf
d_mir <- redoxpeat::d_mir
el_t0 <- redoxpeat::el_t0
fe_t0 <- redoxpeat::fe_t0

# data from other studies/reference HS
ihss <- redoxpeat::ihss
aeschbacher2012 <- redoxpeat::aeschbacher2012
tan2017 <- redoxpeat::tan2017
walpen2018 <- redoxpeat::walpen2018
van_krevelen_om <- redoxpeat::van_krevelen_om

# world map
world <- rnaturalearth::ne_countries(scale = "small", returnclass = "sf")
```


## Study sites

```{r study-sites-map}
# map of sites
d_sites_sf <- 
  d_sites %>%
  dplyr::arrange(site_id) %>%
  sf::st_as_sf(coords = c("longitude", "latitude", "altitude"), crs = 4326)

sites_map <- 
  ggplot(data = world) +
  geom_sf(data = world, colour = NA, fill = "lightgrey") +
  geom_sf(data = d_sites_sf) +
  ggrepel::geom_text_repel(data = d_sites, 
                           aes(x = longitude, 
                               y = latitude, 
                               label = site_name), 
                           force = 4,
                           seed = 1) +
  coord_sf(expand = FALSE) +
  theme_bw() +
  labs(x = "Longitude", y = "Latitude")
```

```{r study-sites-depth-ranges}
# depth range of the lowest layer
d_lowest_layer_depth_range <- 
  d %>% 
  dplyr::filter(!site_label %in% c("LP")) %>%  # discard sites with only three layers
  dplyr::group_by(site_label) %>% 
  dplyr::summarise(depth_lower_max = max(depth_lower, na.rm = TRUE), 
                   depth_upper_max = max(depth_upper, na.rm = TRUE)) %>% dplyr::summarise(depth_lower_max = max(depth_lower_max),                                                  depth_upper_min = min(depth_upper_max))
```


We compiled peat cores collected in the course of different projects from `r length(unique(d$site_label))` peatland sites (one core per site). The different peatland sites are spread across the range of mid to high-latitude peatland areas (figure \ref{fig:study-sites-map-out}), experience different climatic regimes, and comprise both bogs and fens with different dominant vegetation cover (table \ref{tab:t-study-sites}). This enabled us to analyze peat material with a representative range of chemical properties and EAC and EDC.  
Peat samples were selected from four approximate depth levels, depending on the vertical resolution of the peat cores and the maximum depth reached during coring (10 to 20, 30 to 40, 60 to 70 cm, and the deepest available sample per core at depths of `r d_lowest_layer_depth_range$depth_upper_min` to `r d_lowest_layer_depth_range$depth_lower_max` cm). We assumed that the samples cover most of the decomposition and vegetation-shift related variability in peat chemistry and hence EAC and EDC.

```{r study-sites-map-out, fig.width=7, fig.height=3.5, out.width="0.6\\textwidth", fig.cap='Map of the peatland sites from which peat material and data were compiled for this study. The map was created using data from the R package rnaturalearth \\citep{South.2017}.'}
sites_map
```

```{r t-study-sites}
# table with information on the study sites
d_sites %>%
  dplyr::mutate(tmp_mean = round(tmp_mean, 1),
                current_vegetation = 
                  stringr::str_replace_all(current_vegetation, "Sphagnum", "\\\\emph{Sphagnum}") %>%
                  stringr::str_replace_all("Astelia pumila", "\\\\emph{Astelia pumila}"),
                references = c("", "", "", "\\citet{Sagerfors.2008}", "\\citet{Wertebach.2016}", "\\citet{Larina.2013}", "", "", "\\citet{Heffernan.2020}", "\\citet{Heffernan.2020}", "\\citet{Elliott.2012}", "\\citet{Broder.2012}", "\\citet{Mathijssen.2019}", "\\citet{Mathijssen.2019}", "\\citet{Broder.2012}")) %>%
  dplyr::select(site_label, site_name, longitude, latitude, altitude, peatland_type, current_vegetation, tmp_mean, prc_sum, references) %>%
  kableExtra::kable(format = "latex", 
                    booktabs = TRUE, 
                    escape = FALSE, 
                    col.names = c("Site label", "Site name", "Longitude", "Latitude", "Altitude", "Peatland Type", "Current vegetation", "Temperature", "Precipitation", "References"), 
                    caption = 'Overview on the sites from which peat samples and data were derived from. Longitude and latitude are given in decimal degree North and East, respectively, the altitude is given in meter above sea level, peatland type differentiates between bogs and fens following available studies for the respective sites or from own investigations following concepts in \\citet{Rydin.2013}. "Temperature" is the mean annual temperature [$^{\\circ}$C], "Precipitation" is the total annual precipitation [mm], and "References" are references with additional information on the sites. Elevation data were derived from the median values of the GMTED2010 data \\citep{Danielson.2011}. All climate data were derived from the WorldClim version 2.1 climate data for 1970-2000 (30 seconds spatial resolution, monthly temporal resolution) \\citep{Fick.2017}.',
                    align = "clcccclccl") %>%
  kableExtra::landscape() %>%
  kableExtra::kable_styling(latex_options = "scale_down") %>%
  kableExtra::column_spec(7, width = "4cm") %>%
  kableExtra::column_spec(10, width = "4cm")
```

## EAC and EDC measurements

```{r irms-xrf-indices}
# rename duplicate S column
d_xrf <- 
  d_xrf %>%
  dplyr::rename(S_xrf = S)

# combine data
d_elco <- dplyr::left_join(d_irms, d_xrf, by = "id_90")

# replace 0 S content values in d_irms by those in d_xrf
d_elco$S[elco::drop_elco(d_elco$S) == quantities::set_quantities(0, unit = "g/g", errors = 0) | is.na(d_elco$S)] <- d_elco$S_xrf[elco::drop_elco(d_elco$S) == quantities::set_quantities(0, unit = "g/g", errors = 0) | is.na(d_elco$S)]
d_elco$S <- elco::elco_new_elco(d_elco$S, el_symbol = "S")

# remove S_xrf
d_elco <- 
  d_elco %>%
  dplyr::select(-S_xrf)

# copy to enable restoring units
d_elco_or <- d_elco
d_elco_index_elco <- elco::elco_identify_elco_df(d_elco)

# define a dummy sample mass
sample_mass <- 
  quantities::set_quantities(1, unit = "g", errors = 0) %>% 
  rep(nrow(d_elco))

# compute nosc
d_elco <- 
  d_elco %>%
  elco::elco_elco_convert_df(to = "mol", sample_mass = sample_mass) %>%
  dplyr::mutate(nosc = elco::elco_nosc(C, H, N, O))

# restore units
d_elco[, d_elco_index_elco] <- d_elco_or[, d_elco_index_elco]

# compute element ratios (mass/mass)
d_elco <- 
  d_elco %>%
  dplyr::mutate(
    `C:H_m` = C/H,
    `C:N_m` = C/N,
    `C:O_m` = C/O,
    `C:S_m` = C/S,
    `N:P_m` = N/P
  )

# compute element ratios (mol/mol)
d_elco <- 
  d_elco %>%
  elco::elco_elco_convert_df(to = "mol", sample_mass = sample_mass) %>%
  dplyr::mutate(
    `C:H` = C/H,
    `C:N` = C/N,
    `C:O` = C/O,
    `C:S` = C/S,
    `N:P` = N/P,
    `H:C` = H/C,
    `O:C` = O/C,
    `N:C` = N/C,
    `S:C` = S/C
  )

# restore units
d_elco[, which(d_elco_index_elco)] <- d_elco_or[, which(d_elco_index_elco)]
```

```{r fe-preprocessing}
## prepare data on contribution of iron to the EAC and EDC

# compare with xrf data
d_fe_xrf <- 
  dplyr::left_join(d_xrf, 
                   fe_t0 %>% dplyr::select(id_90, fe_tot), 
                   by = "id_90")
d_fe_xrf$fe_tot <- elco::elco_elco_convert(d_fe_xrf$fe_tot, to = "g/g")

# bind to el_t0 to compute contribution to the EAC and EDC
el_t0 <- 
  dplyr::left_join(el_t0,
                   fe_t0 %>% 
                     dplyr::rename(mass_fe = mass) %>% 
                     dplyr::select(id_90, fe2, fe3, mass_fe),
                   by = "id_90")

# compute the contribution of iron to the EAC and EDC
el_t0 <- 
  el_t0 %>%
    dplyr::mutate(
      fe2_n = fe2/errors::drop_errors(elco::drop_elco(C)),
      fe3_n = fe3/errors::drop_errors(elco::drop_elco(C)),
      edc_c_uncorrected = edc_c,
      eac_c_uncorrected = eac_c,
      edc_c_fe_tot = edc_c - (fe2_n + fe3_n),
      eac_c_fe_tot = eac_c - (fe2_n + fe3_n),
      edc_c = edc_c - fe2_n,
      eac_c = eac_c - fe3_n,
      edc_m = edc_c * errors::drop_errors(elco::drop_elco(C)),
      eac_m = eac_c * errors::drop_errors(elco::drop_elco(C))
    )

## plots

# acid extracted total iron vs total iron as determined by XRF
p_fe_xrf_comparison <- 
  d_fe_xrf %>%
  ggplot(aes(x = as.numeric(Fe), y = as.numeric(fe_tot))) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1) +
  labs(y = "Acid extraction iron content [g/g]",
       x = "XRF iron content [g/g]")

# computed contribution of iron to the EAC and EDC, respectively
p_fe_contribution_abs <- 
  dplyr::bind_rows(
    el_t0 %>%
      dplyr::mutate(fe_tot = fe2_n + fe3_n) %>%
      dplyr::select(id_90, site_label, fe_tot) %>%
      dplyr::group_by(id_90, site_label) %>%
      dplyr::summarise(values = median(fe_tot)) %>%
      dplyr::mutate(iron_species = '"Potential contribution of iron ("*Fe[tot]*")"'),
    el_t0 %>%
  dplyr::select(id_90, site_label, fe2_n, fe3_n) %>%
  dplyr::group_by(id_90, site_label) %>%
  dplyr::summarise(fe2_n = median(fe2_n),
                   fe3_n = median(fe3_n),
                   .groups = "drop") %>%
  tidyr::pivot_longer(cols = c("fe2_n", "fe3_n"), 
                      names_to = "iron_species", 
                      values_to = "values") %>%
  dplyr::mutate(iron_species = ifelse(iron_species == "fe3_n", 
                                      '"Iron contribution to the EAC ("*Fe^{3*"+"}*")"', '"Iron contribution to the EDC ("*Fe^{2*"+"}*")"'))
  ) %>%
  ggplot(aes(x = as.numeric(values))) +
  geom_histogram() +
  facet_wrap(~ iron_species, labeller = label_parsed) +
  labs(x = expression(Electrons~per~mass~C~"["*mu*mol~g^{-1}*"]"))

p_fe_contribution_rel <- 
  el_t0 %>%
  dplyr::mutate(fe2_n = fe2_n/(edc/(drop_errors(C) * mass)),
                fe3_n = fe3_n/(eac/(drop_errors(C) * mass))) %>%
  dplyr::select(id_90, site_label, fe2_n, fe3_n) %>%
  dplyr::group_by(id_90, site_label) %>%
  dplyr::summarise(fe2_n = median(fe2_n),
                   fe3_n = median(fe3_n),
                   .groups = "drop") %>%
  tidyr::pivot_longer(cols = c("fe2_n", "fe3_n"), 
                      names_to = "iron_species", 
                      values_to = "values") %>%
  dplyr::mutate(iron_species = ifelse(iron_species == "fe3_n", 
                                      "Iron contribution to the EAC", 
                                      "Iron contribution to the EDC")) %>%
  ggplot(aes(x = as.numeric(values))) +
  geom_histogram() +
  facet_wrap(~ iron_species) +
  labs(x = "Relative contribution of iron")

# potential contribution of iron to the EAC and EDC assuming that all acid extracted iron contributed to the EAC or EDC (irrespective of speciation).
p_fe_contribution_abs1 <- 
  el_t0 %>%
  dplyr::mutate(fe_tot = fe2_n + fe3_n) %>%
  dplyr::select(id_90, site_label, fe_tot) %>%
  dplyr::group_by(id_90, site_label) %>%
  dplyr::summarise(fe_tot = median(fe_tot)) %>%
  ggplot(aes(x = as.numeric(fe_tot))) +
  geom_histogram() +
  labs(x = expression(Electrons~per~mass~C~"["*mu*mol~g^{-1}*"]"))

# uncorrected vs corrected values
p_fe_corrected_uncorrected_df <- 
  dplyr::bind_rows(
    el_t0 %>%
      dplyr::group_by(id_90, site_label) %>%
      dplyr::select(id_90, site_label, eac_c_uncorrected, eac_c, eac_c_fe_tot) %>%
      dplyr::rename(uncorrected = eac_c_uncorrected, 
                    corrected = eac_c, 
                    corrected_fe_tot = eac_c_fe_tot) %>%
      dplyr::summarize_if(is.numeric, 
                          .funs = list(median = mean, sd = sd), 
                          na.rm = T) %>%
      dplyr::mutate(variable = "EAC"),
    el_t0 %>%
      dplyr::group_by(id_90, site_label) %>%
      dplyr::select(id_90, site_label, edc_c_uncorrected, edc_c, edc_c_fe_tot) %>%
      dplyr::rename(uncorrected = edc_c_uncorrected, 
                    corrected = edc_c, 
                    corrected_fe_tot = edc_c_fe_tot) %>%
      dplyr::summarize_if(is.numeric, 
                          .funs = list(median = mean, sd = sd), 
                          na.rm = T) %>%
      dplyr::mutate(variable = "EDC")
  ) %>%
  dplyr::mutate(
    uncorrected_lwr = as.numeric(uncorrected_median) - uncorrected_sd,
    uncorrected_upr = as.numeric(uncorrected_median) + uncorrected_sd,
    corrected_lwr = as.numeric(corrected_median) - corrected_sd,
    corrected_upr = as.numeric(corrected_median) + corrected_sd,
    corrected_fe_tot_lwr = as.numeric(corrected_fe_tot_median) - corrected_fe_tot_sd,
    corrected_fe_tot_upr = as.numeric(corrected_fe_tot_median) + corrected_fe_tot_sd,
    diff = uncorrected_median - corrected_median,
    diff_fe_tot = uncorrected_median - corrected_fe_tot_median
  )

# before filtering
p_fe_corrected_uncorrected1 <- 
  p_fe_corrected_uncorrected_df %>%
  ggplot(
    aes(x = as.numeric(corrected_median), 
        xmin = as.numeric(corrected_lwr),
        xmax = as.numeric(corrected_upr),
        y = as.numeric(corrected_fe_tot_median),
        ymin = as.numeric(corrected_fe_tot_lwr),
        ymax = as.numeric(corrected_fe_tot_upr)
    )) +
  geom_errorbar(colour = "grey", width = 0) +
  geom_errorbarh(colour = "grey", height = 0) +
  geom_point(aes(colour = site_label)) + geom_abline(intercept = 0, slope = 1) +
  geom_smooth(se = FALSE, method = "lm", colour = "grey50") + 
  facet_wrap(~ variable, scales = "free") +
  theme(legend.position = "none") +
  labs(x = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"]"),
       y = expression(EAC - Fe[tot]~or~EDC - Fe[tot]~"["*mu*mol~g[C]^{-1}*"]"))

# after filtering
p_fe_corrected_uncorrected2 <- 
  p_fe_corrected_uncorrected_df %>%
  dplyr::filter(as.numeric(diff_fe_tot) <= 100) %>%
  ggplot(
    aes(x = as.numeric(corrected_median), 
        xmin = as.numeric(corrected_lwr),
        xmax = as.numeric(corrected_upr),
        y = as.numeric(corrected_fe_tot_median),
        ymin = as.numeric(corrected_fe_tot_lwr),
        ymax = as.numeric(corrected_fe_tot_upr)
    )) +
  geom_errorbar(colour = "grey", width = 0) +
  geom_errorbarh(colour = "grey", height = 0) +
  geom_point(aes(colour = site_label)) + geom_abline(intercept = 0, slope = 1) +
  geom_smooth(se = FALSE, method = "lm", colour = "grey50") + 
  facet_wrap(~ variable, scales = "free") +
  theme(legend.position = "none") +
  labs(x = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"]"),
       y = expression(EAC - Fe[tot]~or~EDC - Fe[tot]~"["*mu*mol~g[C]^{-1}*"]"))

# before filtering, against uncorrected values
p_fe_corrected_uncorrected3 <- 
  p_fe_corrected_uncorrected_df %>%
  ggplot(
    aes(x = as.numeric(uncorrected_median), 
        xmin = as.numeric(uncorrected_lwr),
        xmax = as.numeric(uncorrected_upr),
        y = as.numeric(corrected_fe_tot_median),
        ymin = as.numeric(corrected_fe_tot_lwr),
        ymax = as.numeric(corrected_fe_tot_upr)
    )) +
  geom_errorbar(colour = "grey", width = 0) +
  geom_errorbarh(colour = "grey", height = 0) +
  geom_point(aes(colour = site_label)) + geom_abline(intercept = 0, slope = 1) +
  geom_smooth(se = FALSE, method = "lm", colour = "grey50") + 
  facet_wrap(~ variable, scales = "free") +
  theme(legend.position = "none") +
  labs(x = expression(EAC~or~EDC~"["*mu*mol~g[C]^{-1}*"]"),
       y = expression(EAC - Fe[tot]~or~EDC - Fe[tot]~"["*mu*mol~g[C]^{-1}*"]"))

# after filtering, against uncorrected values
p_fe_corrected_uncorrected4 <- 
  p_fe_corrected_uncorrected_df %>%
  dplyr::filter(as.numeric(diff_fe_tot) <= 100) %>%
  ggplot(
    aes(x = as.numeric(uncorrected_median), 
        xmin = as.numeric(uncorrected_lwr),
        xmax = as.numeric(uncorrected_upr),
        y = as.numeric(corrected_fe_tot_median),
        ymin = as.numeric(corrected_fe_tot_lwr),
        ymax = as.numeric(corrected_fe_tot_upr)
    )) +
  geom_errorbar(colour = "grey", width = 0) +
  geom_errorbarh(colour = "grey", height = 0) +
  geom_point(aes(colour = site_label)) + geom_abline(intercept = 0, slope = 1) +
  geom_smooth(se = FALSE, method = "lm", colour = "grey50") + 
  facet_wrap(~ variable, scales = "free") +
  theme(legend.position = "none") +
  labs(x = expression(EAC~or~EDC~"["*mu*mol~g[C]^{-1}*"]"),
       y = expression(EAC - Fe[tot]~or~EDC - Fe[tot]~"["*mu*mol~g[C]^{-1}*"]"))

index_fe_threshold <- 
  tibble::tibble(
    id_90 = p_fe_corrected_uncorrected_df$id_90[p_fe_corrected_uncorrected_df$variable == "EAC"],
    index_eac = as.numeric(p_fe_corrected_uncorrected_df$diff_fe_tot)[p_fe_corrected_uncorrected_df$variable == "EAC"] <= 100,
    index_edc = as.numeric(p_fe_corrected_uncorrected_df$diff_fe_tot)[p_fe_corrected_uncorrected_df$variable == "EDC"] <= 100
  )
```

```{r el-preprocessing}
# plot of the EAC and EDC for each sample
el_preprocessing_p1 <- 
  el_t0 %>%
  dplyr::select(id_90, eac_c, edc_c) %>%
  dplyr::rename('EAC[POM]' = eac_c, 'EDC[POM]' = edc_c) %>%
  tidyr::pivot_longer(cols = c("EAC[POM]", "EDC[POM]"), names_to = "variable", values_to = "value") %>%
  dplyr::mutate(value = units::drop_units(value)) %>%
  ggplot(aes(x = as.factor(id_90), y = value)) +
  facet_wrap(~ variable, scales = "free", labeller = label_parsed) +
  geom_boxplot() +
  coord_flip() +
  labs(y = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"]"),
       x = "Sample")
  
# discard outlier
index <- el_t0$eac_c > units::set_units(1500, "µmol/g")
el_t0 <-
  el_t0 %>%
  dplyr::mutate(eac = replace(eac, index, NA),
                eac_c = replace(eac_c, index, NA),
                eac_m = replace(eac_m, index, NA))

# get number edc measurements <=0
el_t0_negative <- 
  el_t0 %>%
  dplyr::filter(el_t0$edc_c <= units::set_units(0, "µmol/g") & !is.na(el_t0$edc_c))

# summarize
el_t0_summary <- 
  el_t0 %>%
  dplyr::group_by(id_90) %>%
  dplyr::summarise(
    eac1 = quantities::set_quantities(mean(eac, na.rm = TRUE), 
                                     unit = "µmol", 
                                     errors = sd(eac, na.rm = TRUE)),
    eac_c1 = quantities::set_quantities(mean(eac_c, na.rm = TRUE), 
                                       unit = "µmol/g", 
                                       errors = sd(eac_c, na.rm = TRUE)),
    eac_m1 = quantities::set_quantities(mean(eac_m, na.rm = TRUE), 
                                       unit = "µmol/g", 
                                       errors = sd(eac_m, na.rm = TRUE)),
    edc1 = quantities::set_quantities(mean(edc, na.rm = TRUE), 
                                     unit = "µmol", 
                                     errors = sd(edc, na.rm = TRUE)),
    edc_c1 = quantities::set_quantities(mean(edc_c, na.rm = TRUE), 
                                       unit = "µmol/g", 
                                       errors = sd(edc_c, na.rm = TRUE)),
    edc_m1 = quantities::set_quantities(mean(edc_m, na.rm = TRUE), 
                                       unit = "µmol/g", 
                                       errors = sd(edc_m, na.rm = TRUE))
  )

# plot of the standard deviation in dependency of the average
el_t0_summary_sd <- 
  el_t0_summary %>% 
  dplyr::select(eac_c1, edc_c1)

el_t0_summary_sd <- 
  dplyr::bind_rows(
      tibble::tibble(
        variable = "EAC",
        mean = el_t0_summary_sd$eac_c1 %>% quantities::drop_quantities(),
        sd = el_t0_summary_sd$eac_c1 %>% errors::errors()
      ),
      tibble::tibble(
        variable = "EDC",
        mean = el_t0_summary_sd$edc_c1 %>% quantities::drop_quantities(),
        sd = el_t0_summary_sd$edc_c1 %>% errors::errors()
      )
    )
  
el_preprocessing_p2 <-
  el_t0_summary_sd %>%
  ggplot(aes(x = mean, y = sd)) +
  geom_point() +
  facet_wrap(~ variable) +
  geom_smooth(method = "lm", se = FALSE, colour = "darkgrey") +
  labs(x = expression(Average~"["*mu*mol~g[C]^{-1}*"]"),
       y = expression(SD~"["*mu*mol~g[C]^{-1}*"]"))

# set negative edc values to 0
el_t0$edc_c[el_t0$edc_c <= units::set_units(0, "µmol/g") & !is.na(el_t0$edc_c)] <- units::set_units(0, as.character(units(el_t0$edc_c)), mode = "standard")
```


```{r mir-preprocessing}
# interpolation
d_mir <- 
  d_mir %>%
  ir::ir_interpolate(start = NULL, dw = 1)

# clipping to a common wavenumber range
mir_target_range <- 
  tibble::tibble(
    start = 800, # this range was chosen to remove artifacts from clay minerals which have a strong influence on the area normalized intensities
    end = 4000
  )

d_mir <- 
  d_mir %>%
  ir::ir_clip(mir_target_range)

# remove CO2 artifacts
mir_interpolation_range <- 
  tibble::tibble(
    start = 2290,
    end = 2400
  )

d_mir <- 
  d_mir %>%
  ir::ir_interpolate_region(range = mir_interpolation_range)

# baseline correction
bc_range <- 
  tibble::tibble(
    start = min(d_mir$spectra[[1]]$x) + 10, 
    end = max(d_mir$spectra[[1]]$x) - 10
  )

d_mir <- 
  d_mir %>%
  ir::ir_bc(method = "rubberband") %>%
  ir::ir_clip(range = bc_range) %>%
  ir::ir_bc(method = "rubberband")
  
# normalization
d_mir <- 
  d_mir %>%
  ir::ir_normalise(method = "area")

# humification indices
d_mir <- 
  d_mir %>%
  irpeat::irp_hi()
```

```{r data-combine}
# remove unneeded columns
d <- 
  d %>%
  dplyr::select(site_label, site_name, site_order, depth_upper, depth_lower, id_90, id_ftir)
d_mir_combn <- 
  d_mir %>%
  dplyr::rename(id_ftir = sample_id) %>%
  dplyr::mutate(id_ftir = as.character(id_ftir)) %>%
  dplyr::left_join(d %>% 
                     dplyr::select(id_ftir, id_90), 
                   by = c("id_ftir", "id_90"))

# combine all data for the subsequent analyses
d <- 
  list(d, d_elco, el_t0_summary, d_mir_combn) %>%
  purrr::reduce(dplyr::left_join, by = "id_90") %>%
  dplyr::select(-c(id_ftir.x, id_ftir.y))

# set units
d <- 
  d %>%
  dplyr::mutate(
    depth_lower = units::set_units(depth_lower, "cm"),
    depth_upper = units::set_units(depth_upper, "cm")
  )

# define factors
d <- 
  d %>%
  dplyr::mutate(
    site_label = factor(site_label, levels = unique(site_label[order(site_order)])),
    site_name = factor(site_name, levels = unique(site_name[order(site_order)]))
  )

# compute the EDC:EAC ratio from the samples' average values
d$`edc_c1:eac_c1` <- d$edc_c1/d$eac_c1 

# restore class
class(d) <- c("ir", class(d))

# add an index indicating which samples to use during the statistical analyses
d <- 
  d %>% 
  dplyr::mutate(
    index_eac = id_90 %in% {index_fe_threshold %>% 
        dplyr::filter(index_eac) %>% 
        dplyr::select(id_90) %>%
        unlist()},
    index_edc = id_90 %in% {index_fe_threshold %>% 
        dplyr::filter(index_edc) %>% 
        dplyr::select(id_90) %>%
        unlist()}
  )

el_t0_summary <- 
  el_t0_summary %>%
  dplyr::left_join(d %>% dplyr::select(id_90, index_eac, index_edc), by = "id_90")
```

We measured the EAC and EDC of the peat samples using mediated electrochemical reduction (MER) and oxidation (MEO), respectively, following largely the protocols provided by @Lau.2015 and @Gao.2019.  
For this, the peat material was freeze dried (alpha 1-4 plus, Christ, Osterode, Germany) and finely ground to powder in a vibratory cup mill (tungsten carbide cups; Retsch MM 400, Haan, Germany). The ground samples were suspended in water in order to create a suspension that can be pipetted for analyses as described elsewhere [@Lau.2015]. For this, approximately $\SI{0.08}{\g}$ of sample and $\SI{30}{\milli\L}$ of deionized, degassed, and anoxic water were used, or in case of lower amounts of sample available a similar ratio of water to solids.  
The suspensions were transferred into a glove box with N$_2$ atmosphere ($<\SI{1}{ppm}$ O$_2$; Inert Lab Glovebox, Innovative Technology, Amesbury, MA, USA) to perform the electrochemical measurements. For each measurement, an aliquot of each suspension, depending on the total organic carbon content and the expected range of the EAC/EDC (typically $\SI{100}{\micro\L}$ suspension containing $\SI[separate-uncertainty=true, multi-part-units = single]{0.2 \pm 0.01}{\milli\g}$), was transferred into electrochemical cells. The suspensions were continuously stirred (topolino, IKA, Staufen, Germany) to ensure reproducible transfer into the electrochemical cells.  
The electrochemcial cells and analytical setup consisted of a multichannel potentiostat (CH1000, CH Instruments, Austin, TX, USA), glassy carbon working electrodes (Sigradur, HTW, Thierhaupten, Germany), platinum counter electrodes (coiled $\SI{0.4}{\milli\m}$ platinum wire, Sigma-Aldrich, St. Louis, USA), and Ag/AgCl reference electrodes (RE-1B, ALS Co. Ltd, Tokyo, Japan). All potentials were experimentally measured against Ag/AgCl reference, but are reported versus the standard hydrogen electrode.  
The working electrode solution contained KCl as a background electrolyte ($\SI{0.1}{\mol\per\L}$) and was buffered to pH 7 ($\SI{0.2}{\mol\per\L}$ KH$_2$PO$_4$) to ensure stable pH during measurements [@Aeschbacher.2011] and to enable direct comparisons with available data [@Aeschbacher.2010; @Walpen.2018; @Tan.2017]. Prior to analyses of samples $\SI{180}{\micro\L}$ of a \SI{0.1}{\mol\per\L} solution of the mediator diquat (6,7–dihydrodipyrido [1,2–a:20,10–c] pyraziniumdibromid monohydrate; EH$_0=\SI{-0.36}{\V}$; Supelco, USA; 95\% purity) was added for MER, and a similar amount of ABTS (2,2–azino–bis-(3–ethylbenzthiazoline–6–sulfonic acid) ammonium salt; EH$_0=\SI{+0.68}{\V}$; Sigma Aldrich, St. Louis, USA; 98\% purity) for MEO.   
Values of EAC and EDC were determined in MER and MEO, respectively, by integrating the reductive or oxidative current signals over time and normalizing the quantified numbers of electrons transferred to the amount of carbon added for analysis [@Aeschbacher.2010]. The sum of EAC and EDC is referred to as total electron exchange capacity (EEC\textsubscript{tot}).   
Strictly, the obtained EAC and EDC values are the combined EAC and EDC of the POM, DOM, and dissolved inorganic ions and inorganic particles that could be reduced and oxidized, respectively. Prior studies of organic rich sediments and peat samples suggest that dissolved inorganic ions and DOM have a negligible contribution to the EAC and EDC of bulk peat material (\textasciitilde1\%) [@Lau.2015; @Gao.2019] and therefore we assume that our measurements are representative for the solid phase.  
Even though POM is assumed to be the dominant contributor to the EAC and EDC of organic rich sediments such as peat [@Lau.2015; @Gao.2019], solid iron phases can contribute to the EAC and EDC of peat as measured by MER/MEO [@Lau.2015]. We therefore corrected the measured EAC and EDC values for contributions of Fe$^{2+}$ (each mol contributing one mol electrons to the EDC) and Fe$^{3+}$ (each mol contributing one mol electrons to the EAC) [@Lau.2015; @Gao.2019]. To this end, we extracted iron by adding \SI{4}{\milli\liter} \SI{1}{\mol\per\L} HCl to \SI{1}{\milli\liter} of each sample (in some cases less material had to be used), letting the suspensions rest for \SI{72}{\hour} in the dark, and filtering the solution through \SI{0.22}{\micro\meter} Nylon syringe filters. Concentrations of Fe$^{2+}$ and Fe$^{3+}$ in the filtrate were measured spectrophotometrically using the 1,10–phenanthroline method [@Tamura.1974] and from this, we computed the contributions of iron to the EAC (EAC\textsubscript{Fe$^{3+}$}) and EDC (EDC\textsubscript{Fe$^{2+}$}), respectively. The EAC\textsubscript{POM} was then computed by subtracting EAC\textsubscript{Fe$^{3+}$} from the measured EAC and the EDC\textsubscript{POM} by subtracting EDC\textsubscript{Fe$^{2+}$} from the measured EDC [@Lau.2015].  
There are several known issues with this procedure. First, acid extraction may not extract all redox active iron moieties [@Lau.2016]. Second, during acid extraction, the redox equilibrium between iron and OM is shifted and Fe$^{3+}$ may in part be reduced to Fe$^{2+}$ [@Lau.2015]. Consequently, the contribution of iron to the EDC is typically overestimated, whereas the contribution of iron to the EAC is typically underestimated [@Lau.2015].  
The first issue may be negligible for most samples because peat typically contains few mineral particles and hence most iron typically is acid extractable (supporting figure \ref{si-fig:p-fe-xrf-comparison-res}). However, we cannot fully exclude that more iron moieties than that accessible via acid extraction contributed to the EAC and EDC for samples with larger iron contents (supporting figure \ref{si-fig:p-fe-xrf-comparison-res}). The third issue probably affected our calculated EAC\textsubscript{POM} and EDC\textsubscript{POM} values. One indication for this is that `r nrow(el_t0_negative)` EDC\textsubscript{POM} values were negative (minimum: \SI{`r round(min(el_t0_negative$edc_c), 0)`}{\micro\mol\per\gram\carbon}). We therefore assume that the calculated EAC\textsubscript{POM} and EDC\textsubscript{POM} values are biased for samples with high iron content and considered this during data analysis and interpretation.  
We finally report the EAC\textsubscript{POM} and EDC\textsubscript{POM} relative to the C mass of the measured sample (mass of C in the POM suspension aliquot). Moreover, we computed the EAC\textsubscript{POM} and EDC\textsubscript{POM} relative to the total mass of the sample for comparison with values reported in other studies. For each sample, we computed average EAC\textsubscript{POM} and EDC\textsubscript{POM} values and respective standard deviations from the replicate measurements. During this, we discarded one EAC replicate measurement for which we assumed measurement errors because it differed extremely (more than $\SI{1000}{\micro\mol\per\gram\carbon}$) from the remaining replicate measurements for the same sample (supporting figure \ref{si-fig:el-preprocessing-p1-res}).

## Element contents

We analyzed concentrations of C, N, and S for all samples by catalytic combustion using an elemental analyzer (EA 3000, Eurovector, Pavia, Italy). Concentrations of H and O were determined based on the modified Dumas Method, using an CHNS/O analyzer (FlashEA 1112, Thermo Fisher Scientific, Delft, The Netherlands). The nominal oxidation state of C (C$_\textrm{ox}$) was computed from the contents of C, H, N, and O [@Masiello.2008; @Worrall.2016b].  
Total concentrations of other elements (Fe, P and others; see supporting table \ref{si-tab:t-cor-el-xrf} for a full list of measured elements) were determined by wavelength dispersive X-ray fluorescence spectroscopy (WD-XRF; ZSX Primus II, Rigaku, Tokyo, Japan) calibrated with a set of 15 reference materials, consisting of certified plant, peat, and sediment materials, and 5 in-house working standards. Analyses were done on $\SI{500}{\milli\g}$ of ground, powdered sample, pressed to a $\SI{13}{\milli\m}$ pellet (without pelleting aids) at a load of approximately \SI{7}{\tonne}. For few samples, S contents were derived from the WD-XRF data.

## Mid infrared spectroscopy

Fourier-transform mid infrared spectra (MIRS) were used to obtain detailed information on peat molecular structures and to compute regression models for the prediction of peat EAC and EDC. Two mg of powdered sample were mixed with 200 mg KBr (FTIR grade, Sigma Aldrich, St. Louis, MO, USA) and pressed to a 13 mm pellet. Spectra were recorded on a Cary 660 FTIR spectrometer (Agilent, Santa Clara, CA, USA) in the range 650 to 4000 cm$^{-1}$ at a resolution of 0.5 to \SI{2}{\wn}. A number of 32 scans per sample were collected in the absorbance mode and a KBr background was subtracted.  
The recorded MIRS were preprocessed to remove known artifacts and harmonize the data. Spectral preprocessing was performed using the package ir (0.0.0.9000) [@Teickner.2020]. To assess the degree of peat decomposition, we computed a humification index by dividing the intensity at $\SI{1630}{\wn}$ and $\SI{1090}{\wn}$ (denoted as HI\textsubscript{1630/1090}) [@Broder.2012] using irpeat (0.0.0.9000) [@Teickner.2020b].  
Two transformed versions of the spectra were created for the computation of MIRS-based regression models: The first is a binned version and the second is a derived and binned version of the preprocessed spectra. Binning was performed with a bin width of \SI{10}{\wn} to reduce autocorrelation and noise in the spectra. Prior to binning, the preprocessed spectra were derived using a Savitzgy-Golay filter (filter width: \SI{5}{\wn}) [@signaldevelopers.2014]. Derivatization can improve the resolution of features and therefore can improve the predictive accuracy of regression models [@Stuart.2005; @Engel.2013].

## Statistical analyses

### Balancing the analytical bias in EAC\textsubscript{POM} and EDC\textsubscript{POM} values

As mentioned in the previous section, the EAC\textsubscript{POM} and EDC\textsubscript{POM} values computed from measured EAC and EDC values and acid extracted iron ion contents probably are biased, especially for samples with high iron content [@Lau.2015; @Lau.2016]. Since we are interested in electrochemical properties of POM, this bias must be considered during all data analysis steps. We aimed to do this first by quantifying the maximum potential contribution of iron to the EAC and EDC, second, by creating a filtered data set for each the EAC\textsubscript{POM} and EDC\textsubscript{POM} containing only data where the maximum potential contribution of iron to the EAC and EDC was $\le$\SI{100}{\micro\mol\per\gram\carbon}, respectively, and third, performing all analyses for the filtered data set. Analyses for the unfiltered data set can be found in the supplementary information.  
The maximum potential contribution of iron to the EAC and EDC was determined as the total concentration of iron in the acid extract (sum of the concentrations of Fe$^{2+}$ and Fe$^{3+}$). We assumed that non-extracted iron is redox inactive and hence this total iron concentration reflects the maximum potential contribution of iron to either the EAC or EDC, irrespective of the initial redox state and redox state changes during the acid extraction. This assumption is true for samples with low total iron contents, but cannot be validated for samples with larger iron contents (supporting figure \ref{si-fig:p-fe-xrf-comparison-res}) [@Lau.2016]. An overview on the maximum potential contribution of iron to the EAC and EDC across all samples computed from the acid extractable iron content can be found in supporting figure \ref{si-fig:p-fe-contribution-abs-res}. The threshold of $\le$\SI{100}{\micro\mol\per\gram\carbon} was chosen to balance the reduction in the analytical bias in the filtered data and the reduction in sample size, resulting in sample sizes of `r sum(d$index_eac[!is.na(d$C)])` for the EAC and EDC. As a result, there was only a constant offset bias between corrected and uncorrected values for the EAC and EDC (supporting figure \ref{si-fig:p-fe-corrected-uncorrected-res}).  
In general, measured EAC and EDC values typically are much larger than \SI{100}{\micro\mol\per\gram\carbon} and samples with large acid extracted (and total) iron contents typically have a small EAC and EDC (supporting figures \ref{si-fig:p-fe-corrected-uncorrected-res} and \ref{si-fig:p-fe-raw-iron}), suggesting that the maximum bias is probably low. Therefore we assume that it is unlikely that the remaining bias had a large influence on the results. As mentioned above, we cannot, however, fully exclude contributions of non-acid extractable iron minerals to the EAC and EDC. We also note that choosing a tighter filter threshold is likely to cause selection bias since samples with high acid extracted iron content tend to be more decomposed (supporting figure \ref{si-fig:p-fe-decomposition-res}). 


### EAC\textsubscript{POM} and EDC\textsubscript{POM} variability

We created several plots and computed Pearson correlation coefficients to analyze patterns in the samples' EAC\textsubscript{POM} and EDC\textsubscript{POM}. In particular, we compared our EAC\textsubscript{POM} and EDC\textsubscript{POM} values with those measured for various HS and DOM samples in other studies [@Aeschbacher.2012; @Tan.2017; @Walpen.2018]. These values from other studies were extracted from the publications' figures using the R package digitize [@Poisot.2011]. <!--Finally, we plotted the EDC\textsubscript{POM} versus the EAC\textsubscript{POM} to analyze their relation (inspired by @Aeschbacher.2012). We did not include analyses for the EEC\textsubscript{POM} (EAC\textsubscript{POM} + EDC\textsubscript{POM}) since the EEC\textsubscript{POM} is strongly related to the EAC\textsubscript{POM} (Pearson correlation $=`r round(cor(d[, "eac_c1"], d[, "eac_c1"] + d[, "edc_c1"], use = "pairwise.complete.obs"), 2)`$ and $`r round(cor(d[d$index_eac & d$index_edc, "eac_c1"], d[d$index_eac & d$index_edc, "eac_c1"] + d[d$index_eac & d$index_edc, "edc_c1"], use = "pairwise.complete.obs"), 2)`$ for the filtered and unfiltered data, respectively).-->  

```{r explorative-el-plot-comparison-literature, results='hide'}
## plot comparing EAC and EDC values to values reported in other studies using the same measurement approach

# prepare data.frame for plotting
d_el_comparison <- 
  dplyr::bind_rows(
    d %>%
      dplyr::select(eac_m1, edc_m1, index_eac, index_edc) %>%
      dplyr::mutate_if(is.numeric, as.numeric) %>%
      dplyr::rename(EAC = eac_m1, EDC = edc_m1) %>%
      dplyr::mutate(Source = "This study"),
    aeschbacher2012 %>%
      dplyr::select(EAC, EDC) %>%
      dplyr::mutate_if(
        is.numeric, function(x) {
          units(x) <- with(units::ud_units, "µmol/g")
          units::drop_units(x)
      }) %>%
      dplyr::mutate(Source = "Aeschbacher et al. (2012)"),
    tan2017 %>%
      dplyr::rename(EAC = "eac", EDC = "edc") %>%
      dplyr::select(EAC, EDC) %>%
      dplyr::mutate_if(is.numeric, function(x) {
        units(x) <- with(units::ud_units, "µmol/g")
        units::drop_units(x)
      }) %>%
      dplyr::mutate(Source = "Tan et al. (2017)")
  )

# stack values
d_el_comparison <- 
  d_el_comparison %>%
  tidyr::pivot_longer(cols = c(EAC, EDC), 
                      values_to = "values", 
                      names_to = "variable")

# plot
p_el_comparison <- 
  d_el_comparison %>%
  ggplot(aes(x = values, fill = Source)) + 
  geom_histogram() + 
  labs(x = expression(EAC~or~EDC~"["*mu*mol~g[sample]^{-1}*"]"),
       y = "Count") + 
  facet_wrap(~ variable) +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(title.position="top")) +
  scale_fill_grey()

## the same plot, but now for studies with values in mol(g C)^{-1}

d_el_comparison2 <- 
  dplyr::bind_rows(
    d %>%
      dplyr::select(eac_c1, edc_c1, index_eac, index_edc) %>%
      dplyr::mutate_if(is.numeric, as.numeric) %>%
      dplyr::rename(EAC = eac_c1, EDC = edc_c1) %>%
      dplyr::mutate(Source = "This study"),
    walpen2018 %>%
      dplyr::filter(sample_type == "pool_water") %>%
      dplyr::rename(EAC = eac_mean, EDC = edc_mean) %>%
      dplyr::select(EAC, EDC) %>%
      dplyr::mutate_if(
        is.numeric, function(x) {
          units(x) <- with(units::ud_units, "µmol/g")
          units::drop_units(x)
      }) %>%
      dplyr::mutate(Source = "Walpen et al. (2018), poolwater DOM"),
    walpen2018 %>%
      dplyr::filter(sample_type == "pore_water") %>%
      dplyr::rename(EAC = eac_mean, EDC = edc_mean) %>%
      dplyr::select(EAC, EDC) %>%
      dplyr::mutate_if(
        is.numeric, function(x) {
          units(x) <- with(units::ud_units, "µmol/g")
          units::drop_units(x)
      }) %>%
      dplyr::mutate(Source = "Walpen et al. (2018), porewater DOM")
  ) %>% 
  dplyr::mutate(Source = factor(Source, levels = c("Walpen et al. (2018), poolwater DOM", "Walpen et al. (2018), porewater DOM", "This study")))

# stack values
d_el_comparison2  <- 
  d_el_comparison2 %>%
  tidyr::pivot_longer(cols = c(EAC, EDC), 
                      values_to = "values", 
                      names_to = "variable")

# plot
p_el_comparison2 <- 
  d_el_comparison2 %>%
  ggplot(aes(x = values, fill = Source)) + 
  geom_histogram() + 
  labs(x = expression(EAC~or~EDC~"["*mu*mol~g[C]^{-1}*"]"),
       y = "Count") + 
  facet_wrap(~ variable) +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(title.position="top")) +
  scale_fill_grey()

## the same again, but now filtered fo Fe

# plot
p_el_comparison_fe <-
  d_el_comparison %>%
  dplyr::mutate(
    index = 
      dplyr::case_when(
        is.na(index_eac) ~ TRUE,
        variable == "EAC" ~ index_eac,
        variable == "EDC" ~ index_edc
      )
  ) %>%
  dplyr::filter(index) %>%
  ggplot(aes(x = values, fill = Source)) + 
  geom_histogram() + 
  labs(x = expression(EAC~or~EDC~"["*mu*mol~g[sample]^{-1}*"]"),
       y = "Count") + 
  facet_wrap(~ variable) +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(title.position = "top", ncol = 1)) +
  scale_fill_grey()

# plot
p_el_comparison2_fe <- 
  d_el_comparison2 %>%
  dplyr::mutate(
    index = 
      dplyr::case_when(
        is.na(index_eac) ~ TRUE,
        variable == "EAC" ~ index_eac,
        variable == "EDC" ~ index_edc
      )
  ) %>%
  dplyr::filter(index) %>%
  ggplot(aes(x = values, fill = Source)) + 
  geom_histogram() + 
  labs(x = expression(EAC~or~EDC~"["*mu*mol~g[C]^{-1}*"]"),
       y = "Count") + 
  facet_wrap(~ variable) +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(title.position = "top", ncol = 1)) +
  scale_fill_grey()

```

```{r p-el-depth-profile}
## Depth profiles of the EAC and EDC for each site

# get median values
el_depth_profiles <-
  d %>%
  dplyr::filter(!is.na(C)) %>%
  dplyr::select(site_label, depth_upper, eac_c1, edc_c1, index_eac, index_edc) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
    dplyr::rename('EAC[POM]' = "eac_c1", 'EDC[POM]' = "edc_c1") %>%
  tidyr::pivot_longer(cols = dplyr::all_of(c("EAC[POM]", "EDC[POM]")), 
                      names_to = "variable", 
                      values_to = "values") %>%
  dplyr::mutate(
    index = 
      dplyr::case_when(
        variable == "EAC[POM]" ~ index_eac,
        variable == "EDC[POM]" ~ index_edc
      )
  )

# get standard errors
el_depth_profiles_errors <-
  d %>%
  dplyr::filter(!is.na(C)) %>%
  dplyr::select(site_label, depth_upper, eac_c1, edc_c1) %>%
  dplyr::mutate(
    dplyr::across(dplyr::all_of(c("eac_c1", "edc_c1")), 
                  .fns = errors)
    ) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  dplyr::rename('EAC[POM]' = "eac_c1", 'EDC[POM]' = "edc_c1") %>%
  tidyr::pivot_longer(cols = dplyr::all_of(c("EAC[POM]", "EDC[POM]")), 
                      names_to = "variable", 
                      values_to = "errors")

# combine median and error values
el_depth_profiles <- dplyr::left_join(el_depth_profiles, 
                                      el_depth_profiles_errors, 
                                      by = c("site_label", "depth_upper", "variable"))

# order sites according to the median EAC
site_label_order_eac_c <- 
  el_t0 %>%
  dplyr::group_by(site_label) %>%
  dplyr::summarise(eac_c = median(eac_c, na.rm = TRUE),
                   .groups = "drop") %>%
  dplyr::arrange(eac_c) %>%
  dplyr::select(site_label) %>%
  unlist() %>%
  stringr::str_replace(pattern = " ", replacement = "~")

el_depth_profiles$site_label <- 
  factor(stringr::str_replace(el_depth_profiles$site_label, pattern = " ", replacement = "~"), 
         levels = site_label_order_eac_c)  

# define a reverted log transformed scale (source: https://stackoverflow.com/questions/11053899/how-to-get-a-reversed-log10-scale-in-ggplot2)
reverselog_trans <- 
  function(base = exp(1)) {
    trans <- function(x) -log(x, base)
    inv <- function(x) base^(-x)
    scales::trans_new(paste0("reverselog-", format(base)), 
                      trans, 
                      inv, 
                      scales::log_breaks(base = base), 
                      domain = c(1e-100, Inf))
  }

# plot
p_el_depth_profiles <- 
  ggplot(el_depth_profiles, 
         aes(x = values, 
             y = depth_upper,
             xmin = values - errors, 
             xmax = values + errors)
  )  +
  geom_errorbarh(height = 0) +
  geom_path(size = 2, colour = "dimgrey") +
  facet_grid(site_label ~ variable, scales = "free_x", labeller = label_parsed) + 
  scale_y_continuous(trans = reverselog_trans(10)) +
  #scale_x_continuous(labels=function(x) x / 1000) +
  labs(y = "Depth of upper boundary [cm]", 
       x = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"]"))

# plot with EAC/EDC values filtered according to the contribution of iron to the EAC/EDC
p_el_depth_profiles_fe <- 
  cowplot::ggdraw(
    p_el_depth_profiles +
      geom_point(aes(fill = index), shape = 21) +
      guides(fill = guide_legend(title = "\n", title.position="top")) +
      scale_fill_grey(start = 0, end = 1) +
      theme(legend.position = "bottom")
  ) +
  cowplot::draw_label("Potential contribution of iron to the", 
                      x = 0.55, y = 0.07, size = 11, ) +
  cowplot::draw_label(expression("EAC or EDC" <=100~mu*mol~g[C]^{-1}~" "), 
                      x = 0.51, y = 0.05, size = 11)
```

```{r explorative-el-plot-EAC-EDC}
## plot of the EAC vs the EDC, as in Aeschbacher et al. (2012)

# prepare the data for plotting
el_t0_summary_sd1 <- 
  el_t0_summary %>% 
  dplyr::select(eac_c1, edc_c1, index_eac, index_edc) %>%
  dplyr::rename(eac = eac_c1, edc = edc_c1) %>%
  dplyr::mutate(
    eac_mean = quantities::drop_quantities(eac),
    eac_sd = errors::errors(eac),
    edc_mean = quantities::drop_quantities(edc),
    edc_sd = errors::errors(edc)
  )

# plot
p_el_eac_edc <- 
  el_t0_summary_sd1 %>%
  ggplot(aes(x = eac_mean, xmin = eac_mean - eac_sd, xmax = eac_mean + eac_sd,
             y = edc_mean, ymin = edc_mean - edc_sd, ymax = edc_mean + edc_sd)) +
  geom_errorbar(width = 0, colour = "grey") +
  geom_errorbarh(height = 0, colour = "grey") +
  geom_abline(intercept = 0, slope = 1, colour = "black", linetype = 2) +
  geom_point(size = 2, shape = 21, fill = "white") +
  coord_fixed(ratio = 1, 
              xlim = c(0,
                       max(c(el_t0_summary_sd1$eac_mean + el_t0_summary_sd1$eac_sd,
                             el_t0_summary_sd1$edc_mean + el_t0_summary_sd1$edc_sd)
                       )),
              ylim = c(0,
                       max(c(el_t0_summary_sd1$eac_mean + el_t0_summary_sd1$eac_sd,
                             el_t0_summary_sd1$edc_mean + el_t0_summary_sd1$edc_sd)
                       ))) +
  scale_x_continuous(breaks = seq(0, 1000, 250)) +
  scale_y_continuous(breaks = seq(0, 1000, 250)) +
  labs(x = expression(EAC[POM]~"["*mu*mol~g[C]^{-1}*"]"), 
       y = expression(EDC[POM]~"["*mu*mol~g[C]^{-1}*"]"))

## the same plot as above, but with additional data from the literature

# combine data
el_t0_summary_sd2 <- 
  el_t0_summary %>% 
  dplyr::select(eac_m1, edc_m1) %>%
  dplyr::rename(eac = eac_m1, edc = edc_m1) %>%
  dplyr::summarise(
    dplyr::across(
      .cols = dplyr::everything(), 
      .fns = list(mean = function(x) quantities::drop_quantities(x), 
                  sd = function(x) errors::errors(x))
    ))

el_t0_summary_sd2 <- 
  dplyr::bind_rows(
    el_t0_summary_sd2 %>%
      dplyr::mutate(Source = "This study") %>%
      dplyr::rename(EAC = eac_mean, EDC = edc_mean), 
    aeschbacher2012 %>%
      dplyr::select(EAC, EDC) %>%
      dplyr::mutate_if(
        is.numeric, function(x) {
          units(x) <- with(units::ud_units, "µmol/g")
          units::drop_units(x)
      }) %>%
      dplyr::mutate(Source = "Aeschbacher et al. (2012)"),
    tan2017 %>%
      dplyr::rename(EAC = "eac", EDC = "edc") %>%
      dplyr::select(EAC, EDC) %>%
      dplyr::mutate_if(is.numeric, function(x) {
        units(x) <- with(units::ud_units, "µmol/g")
        units::drop_units(x)
      }) %>%
      dplyr::mutate(Source = "Tan et al. (2017)")
  )

# plot
p_el_eac_edc2 <- 
  el_t0_summary_sd2 %>%
  ggplot(aes(x = EAC, xmin = EAC - eac_sd, xmax = EAC + eac_sd,
             y = EDC, ymin = EDC - edc_sd, ymax = EDC + edc_sd,
             fill = Source)) +
  geom_errorbar(width = 0, colour = "grey") +
  geom_errorbarh(height = 0, colour = "grey") +
  geom_abline(intercept = 0, slope = 1, colour = "black", linetype = 2) +
  geom_point(size = 2, shape = 21) +
  coord_fixed(ratio = 1, 
              xlim = c(0,
                       max(c(el_t0_summary_sd2$EAC,
                             el_t0_summary_sd2$EDC)
                       )),
              ylim = c(0,
                       max(c(el_t0_summary_sd2$EAC + ifelse(is.na(el_t0_summary_sd2$eac_sd), 0, el_t0_summary_sd2$eac_sd),
                             el_t0_summary_sd2$EDC + ifelse(is.na(el_t0_summary_sd2$edc_sd), 0, el_t0_summary_sd2$edc_sd))
                       ))) +
  scale_x_continuous(breaks = seq(0, 3000, 500)) +
  scale_y_continuous(breaks = seq(0, 3000, 500)) +
  labs(x = expression("EAC ["*mu*mol~g[sample]^{-1}*"]"), 
       y = expression("EDC ["*mu*mol~g[sample]^{-1}*"]"))

## the same plot as p_el_eac_edc, but with samples filtered according to the potential contribution of iron to the EAC/EDC
p_el_eac_edc_fe <- 
  el_t0_summary_sd1 %>%
  dplyr::filter(index_eac + index_edc == 2L) %>%
  ggplot(aes(x = eac_mean, xmin = eac_mean - eac_sd, xmax = eac_mean + eac_sd,
             y = edc_mean, ymin = edc_mean - edc_sd, ymax = edc_mean + edc_sd)) +
  geom_errorbar(width = 0, colour = "grey") +
  geom_errorbarh(height = 0, colour = "grey") +
  geom_abline(intercept = 0, slope = 1, colour = "black", linetype = 2) +
  geom_point(size = 2, shape = 21, fill = "white") +
  coord_fixed(ratio = 1, 
              xlim = c(0,
                       max(c(el_t0_summary_sd1$eac_mean + el_t0_summary_sd1$eac_sd,
                             el_t0_summary_sd1$edc_mean + el_t0_summary_sd1$edc_sd)
                       )),
              ylim = c(0,
                       max(c(el_t0_summary_sd1$eac_mean + el_t0_summary_sd1$eac_sd,
                             el_t0_summary_sd1$edc_mean + el_t0_summary_sd1$edc_sd)
                       ))) +
  scale_x_continuous(breaks = seq(0, 1000, 250)) +
  scale_y_continuous(breaks = seq(0, 1000, 250)) +
  labs(x = expression(EAC[POM]~"["*mu*mol~g[C]^{-1}*"]"), 
       y = expression(EDC[POM]~"["*mu*mol~g[C]^{-1}*"]"))

```

### Relation to Chemical Properties, Decomposition Indicators, and Infrared Spectra

To analyze the relation of the EAC\textsubscript{POM}, EDC\textsubscript{POM}, and EDC\textsubscript{POM}:EAC\textsubscript{POM} ratio to different indicators of bulk peat chemistry (H:C, O:C, N:C, S:C ratio, HI$_\text{1630/1090}$, and C$_\text{OX}$), we created scatterplots and computed their pairwise Pearson correlation ($\rho$). The H:C ratio has been shown to relate negatively to the EAC and EDC of HS [@Aeschbacher.2010; @Tan.2017; @Lv.2018]. The O:C, N:C, S:C ratio, and C$_\text{OX}$ are indicators for peat decomposition [@Masiello.2008; @Biester.2014; @Leifeld.2012] and C$_\text{OX}$ was positively related to the EDC of HS [@Lv.2018]. The O:C ratio is an indicator for the amount of polysaccharides [@Kim.2003] which are not assumed to contribute to the EAC\textsubscript{POM} and EDC\textsubscript{POM}. There is some evidence for the contribution of nitrogen and sulfur containing functional groups to the EAC\textsubscript{POM} and EDC\textsubscript{POM} [@Ratasuk.2007; @Fimmen.2007; @HernandezMontoya.2012] and the N:C, and S:C ratio might give information on this, too.  
To qualitatively analyze potential joint effects of the H:C and O:C ratio and relate their variability to different OM fractions, we created van-Krevelen plots. For some International Humic Substances Society (IHSS) reference samples, information on element contents [@HuffmanLaboratories.NA] and EAC and EDC [@Aeschbacher.2012] are available. We therefore could include these samples in the van-Krevelen plots. Finally, we computed correlation spectra for the EAC\textsubscript{POM} and EDC\textsubscript{POM} by computing the Pearson correlation of both variables with each MIRS variable. This allowed us to investigate relations to molecular structures derived from MIRS. 

```{r explorative-van-krevelen}
## van-Krevelen-like plot, only with the data measured for this study

# prepare data frame (differentiating between layers)
d_el_ch_co <- 
  d %>%
  dplyr::select(dplyr::all_of(c("site_label", "eac_m1", "edc_m1", "H:C", "O:C", "N:C", "index_eac", "index_edc"))) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  dplyr::rename('EAC[POM]' = eac_m1, 'EDC[POM]' = edc_m1) %>%
  tidyr::pivot_longer(cols = c('EAC[POM]', 'EDC[POM]'), 
                      names_to = "variable", 
                      values_to = "values") %>%
  dplyr::mutate(sample_type = "Peat POM (this study)",
                el_available = TRUE,
                values = values/1000)

# plot for the EAC
p1 <- 
  d_el_ch_co %>%
  dplyr::filter(variable == "EAC[POM]") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  # geom_smooth(aes(colour = site_label), method = "lm", se = FALSE) +
  geom_point(aes(size = as.numeric(values), fill = site_label), shape = 21) + 
  facet_wrap(~variable, labeller = label_parsed) +
  labs(x = "O:C [mol/mol]",
       y = "H:C [mol/mol]") +
  guides(size = FALSE, fill = guide_legend(title = "Site", override.aes = list(size = 3.5))) + 
  theme(legend.position = "none")

p1_legend <- 
  {p1  + 
  theme(legend.position = "bottom")} %>% 
  cowplot::get_legend()  

# plot for the EDC
p2 <- 
  d_el_ch_co %>%
  dplyr::filter(variable == "EDC[POM]") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  # geom_smooth(aes(colour = site_label), method = "lm", se = FALSE) +
  geom_point(aes(size = as.numeric(values), fill = site_label), shape = 21) + 
  facet_wrap(~variable, labeller = label_parsed) +
  labs(x = "O:C [mol/mol]") +
  guides(size = FALSE) +
  theme(legend.position = "none",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.line.y = element_blank(),
        axis.title.y = element_blank())

# combine plots and legend
p_el_ch_co1 <- 
  cowplot::plot_grid(
    plotlist = list(cowplot::plot_grid(plotlist = list(p1, p2), ncol = 2, rel_widths = c(1, 0.87)),
                    p1_legend),
    nrow = 2,
    rel_heights = c(1, 0.3)
  )

## van-Krevelen-like plot, additionally with data from the IHSS reference materials

# compute element ratios
ihss_elco <- 
  ihss %>% 
  dplyr::select(C, H, O, N) %>%
  purrr::map2_df(., colnames(.), function(x, y) {
    errors::set_errors(x, 0) %>%
      elco::elco_new_elco(el_symbol = y) %>%
      elco::elco_elco_convert(to = "mol/g")  
  }) %>%
  dplyr::mutate(
    `H:C` = H/C,
    `O:C` = O/C,
    `C:H` = C/H,
    `C:O` = C/O,
    `C:N` = C/N,
    `N:C` = N/C
  ) %>%
  dplyr::bind_cols(
    ihss %>% dplyr::select(name, catalog_number)
  )

# add EAC and EDC values
ihss_elco <- 
  dplyr::left_join(ihss_elco, aeschbacher2012, by = "catalog_number") %>%
  dplyr::select(dplyr::all_of(c("H:C", "O:C", "N:C", "EAC", "EDC", "name"))) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
   tidyr::pivot_longer(cols = c("EAC", "EDC"), 
                      names_to = "variable", 
                      values_to = "values") %>%
  dplyr::mutate(sample_type = "HS (Aeschbacher et al. (2012))",
                el_available = !is.na(values),
                site_label = name) %>%
  dplyr::select(-name)


# combine
d_el_ch_co_ihss <- 
  dplyr::bind_rows(d_el_ch_co, ihss_elco) %>%
  dplyr::mutate(variable = dplyr::case_when(variable == "EAC[POM]" ~ "EAC",
                                            variable == "EDC[POM]" ~ "EDC",
                                            TRUE ~ variable)) %>%
  dplyr::mutate(index = dplyr::case_when(
    sample_type == "HS (Aeschbacher et al. (2012))" ~ TRUE,
    variable == "EAC" ~ index_eac,
    variable == "EDC" ~ index_edc
  ))

# van-Krevelen label positions
van_krevelen_om_labels <- 
  van_krevelen_om %>%
  dplyr::mutate(
    `O:C` = `O:C` + c(0.1, -0.4, -0.15, 0.15, -0.25),
    `H:C` = `H:C` + c(0, 1.17 - 0.868, 1.6 - 1.75, 0.07, 0.25),
    om_fraction = c(om_fraction[[1]], "condensed\nhydrocarbons", om_fraction[3:5])
  )

# PFLA position
pfla_labels <- 
  tibble::tibble(`H:C` = 1.23, `O:C` = 0.27, label = "PLFA")

# plot for the EAC
p1 <- 
  d_el_ch_co_ihss %>%
  dplyr::filter(variable == "EAC") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  ggforce::geom_ellipse(data = van_krevelen_om, aes(x0 =`O:C`, y0 =`H:C`, a = oc_halfwidth, b = hc_halfwidth, angle = angle), colour = NA, fill = "lightgrey") +
  geom_text(data = van_krevelen_om_labels, aes(label = om_fraction), hjust = 0, colour = "dimgrey") +
  geom_text(data = pfla_labels, aes(label = label), hjust = 0, colour = "black", size = 3) +
  geom_point(colour = "dimgrey", size = 1) +
  geom_point(aes(size = as.numeric(values), fill = sample_type), shape = 21) + 
  facet_wrap(~variable) +
  scale_x_continuous(breaks = seq(0, 0.9, 0.3)) +
  labs(x = "O:C [mol/mol]",
       y = "H:C [mol/mol]") +
  guides(size = FALSE, fill = guide_legend(title = "Study/Sample type", override.aes = list(size = 3.5))) + 
  theme(legend.position = "none")

p1_legend <- 
  {p1  + 
  theme(legend.position = "bottom")} %>% 
  cowplot::get_legend() 

# plot for the EDC
p2 <- 
  d_el_ch_co_ihss %>%
  dplyr::filter(variable == "EDC") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  ggforce::geom_ellipse(data = van_krevelen_om, aes(x0 =`O:C`, y0 =`H:C`, a = oc_halfwidth, b = hc_halfwidth, angle = angle), colour = NA, fill = "lightgrey") +
    geom_text(data = van_krevelen_om_labels, aes(label = om_fraction), hjust = 0, colour = "dimgrey") +
  geom_text(data = pfla_labels, aes(label = label), hjust = 0, colour = "black", size = 3) +
  geom_point(colour = "dimgrey", size = 1) +
  geom_point(aes(size = as.numeric(values), fill = sample_type), shape = 21) + 
  facet_wrap(~variable) +
  scale_x_continuous(breaks = seq(0, 0.9, 0.3)) +
  labs(x = "O:C [mol/mol]",
       y = "H:C [mol/mol]") +
  guides(size = FALSE, fill = guide_legend(title = "Site", override.aes = list(size = 3.5))) +
  theme(legend.position = "none",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.line.y = element_blank(),
        axis.title.y = element_blank())

# combine plots and legend
p_el_ch_co2 <- 
  cowplot::plot_grid(
    plotlist = 
      list(cowplot::plot_grid(plotlist = list(p1, p2), 
                              ncol = 2, 
                              rel_widths = c(1, 0.85)),
           p1_legend),
    nrow = 2,
    rel_heights = c(1, 0.3)
  )

## the same as p_el_ch_co1, but with samples filtered for the potential contribution of Fe to the EAC/EDC
# plot for the EAC
p1 <- 
  d_el_ch_co %>%
  dplyr::filter(index_eac) %>%
  dplyr::filter(variable == "EAC[POM]") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  # geom_smooth(aes(colour = site_label), method = "lm", se = FALSE) +
  geom_point(aes(size = as.numeric(values), fill = site_label), shape = 21) + 
  facet_wrap(~ variable, labeller = label_parsed) +
  labs(x = "O:C [mol/mol]",
       y = "H:C [mol/mol]") +
  guides(size = FALSE, fill = guide_legend(title = "Site", override.aes = list(size = 3.5))) + 
  theme(legend.position = "none")

p1_legend <- 
  {p1  + 
  theme(legend.position = "bottom")} %>% 
  cowplot::get_legend()  

# plot for the EDC
p2 <- 
  d_el_ch_co %>%
  dplyr::filter(index_edc) %>%
  dplyr::filter(variable == "EDC[POM]") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  # geom_smooth(aes(colour = site_label), method = "lm", se = FALSE) +
  geom_point(aes(size = as.numeric(values), fill = site_label), shape = 21) + 
  facet_wrap(~ variable, labeller = label_parsed) +
  labs(x = "O:C [mol/mol]") +
  guides(size = FALSE) +
  theme(legend.position = "none",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.line.y = element_blank(),
        axis.title.y = element_blank())

# combine plots and legend
p_el_ch_co1_fe <- 
  cowplot::plot_grid(
    plotlist = list(cowplot::plot_grid(plotlist = list(p1, p2), ncol = 2, rel_widths = c(1, 0.87)),
                    p1_legend),
    nrow = 2,
    rel_heights = c(1, 0.3)
  )

# plot for the EAC
p1 <- 
  d_el_ch_co_ihss %>%
  dplyr::filter(index) %>%
  dplyr::filter(variable == "EAC") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  ggforce::geom_ellipse(data = van_krevelen_om, aes(x0 =`O:C`, y0 =`H:C`, a = oc_halfwidth, b = hc_halfwidth, angle = angle), colour = NA, fill = "lightgrey") +
  geom_text(data = van_krevelen_om_labels, aes(label = om_fraction), hjust = 0, colour = "dimgrey") +
  geom_text(data = pfla_labels, aes(label = label), hjust = 0, colour = "black", size = 3) +
  geom_point(colour = "dimgrey", size = 1) +
  geom_point(aes(size = as.numeric(values), fill = sample_type), shape = 21) + 
  facet_wrap(~variable) +
  scale_x_continuous(breaks = seq(0, 0.9, 0.3)) +
  labs(x = "O:C [mol/mol]",
       y = "H:C [mol/mol]") +
  guides(size = FALSE, fill = guide_legend(title = "Study/Sample type", override.aes = list(size = 3.5))) + 
  theme(legend.position = "none")

p1_legend <- 
  {p1  + 
  theme(legend.position = "bottom")} %>% 
  cowplot::get_legend() 

# plot for the EDC
p2 <- 
  d_el_ch_co_ihss %>%
  dplyr::filter(index) %>%
  dplyr::filter(variable == "EDC") %>%
  ggplot(aes(x = as.numeric(`O:C`), y = as.numeric(`H:C`))) +
  ggforce::geom_ellipse(data = van_krevelen_om, aes(x0 =`O:C`, y0 =`H:C`, a = oc_halfwidth, b = hc_halfwidth, angle = angle), colour = NA, fill = "lightgrey") +
    geom_text(data = van_krevelen_om_labels, aes(label = om_fraction), hjust = 0, colour = "dimgrey") +
  geom_text(data = pfla_labels, aes(label = label), hjust = 0, colour = "black", size = 3) +
  geom_point(colour = "dimgrey", size = 1) +
  geom_point(aes(size = as.numeric(values), fill = sample_type), shape = 21) + 
  facet_wrap(~variable) +
  scale_x_continuous(breaks = seq(0, 0.9, 0.3)) +
  labs(x = "O:C [mol/mol]",
       y = "H:C [mol/mol]") +
  guides(size = FALSE, fill = guide_legend(title = "Site", override.aes = list(size = 3.5))) +
  theme(legend.position = "none",
        axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.line.y = element_blank(),
        axis.title.y = element_blank())

# combine plots and legend
p_el_ch_co2_fe <- 
  cowplot::plot_grid(
    plotlist = 
      list(cowplot::plot_grid(plotlist = list(p1, p2), 
                              ncol = 2, 
                              rel_widths = c(1, 0.85)),
           p1_legend),
    nrow = 2,
    rel_heights = c(1, 0.3)
  )
```

```{r explorative-value-range, cache=TRUE}
## value ranges for target variables

# target variables
target_variables <- c("N:C", "H:C", "O:C", "S:C", "hi3", "nosc", "eac_c1", "edc_c1", "edc_c1:eac_c1")
target_variables_pretty <- c("N:C", "H:C", "O:C", "S:C", "HI", "C[OX]", "EAC", "EDC", "EDC:EAC")

# total range of target variables
d_ranges_all <- 
  d %>%
  dplyr::select(dplyr::all_of(target_variables[!target_variables %in% c("eac_c1", "eac_c1")])) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  dplyr::summarise(
    dplyr::across(
      .cols = dplyr::everything(), 
      .fns = list(min = min, 
                  max = max, 
                  mean = mean), 
      na.rm = TRUE
    ))

# total ranges of EAC and EDC replicate measurements
d_ranges_all <- 
  el_t0 %>%
  dplyr::select(c("eac_c", "edc_c")) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  dplyr::summarise(
    dplyr::across(
      .cols = dplyr::everything(), 
      .fns = list(min = min, 
                  max = max, 
                  mean = mean), 
      na.rm = TRUE
    )) %>%
  dplyr::bind_cols(d_ranges_all)

# within-site ranges of target variables
d_ranges_sites <- 
  d %>%
  dplyr::group_by(site_label) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  dplyr::select(target_variables[!target_variables %in% c("eac_c1", "edc_c1")]) %>%
  dplyr::summarise(
    dplyr::across(
      .cols = dplyr::everything(), 
      .fns = list(min = min, 
                  max = max, 
                  mean = mean), 
      na.rm = TRUE
    ))

# within-site ranges of EAC and EDC replicate measurements
d_ranges_sites <- 
  el_t0 %>%
  dplyr::group_by(site_label, id_90) %>%
  dplyr::select(c("eac_c", "edc_c")) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  dplyr::summarise(
    dplyr::across(
      .cols = dplyr::everything(), 
      .fns = mean, 
      na.rm = TRUE
    ), .groups = "drop") %>%
  dplyr::select(-id_90) %>%
  dplyr::group_by(site_label) %>%
  dplyr::summarise(
    dplyr::across(
      .cols = dplyr::everything(), 
      .fns = list(min = min, 
                  max = max, 
                  mean = mean), 
      na.rm = TRUE
    )) %>%
  dplyr::left_join(d_ranges_sites, by = "site_label")
```

```{r explorative-correlation}
## Pearson correlation between target variables

# compute correlation values
d_cor <- 
  d %>%
  dplyr::select(dplyr::all_of(target_variables)) %>%
  cor(use = "pairwise.complete.obs") %>%
  as.data.frame()

# compute correlation values with the filtered data set
d_cor_fe_eac <- 
  d %>%
  dplyr::filter(index_eac) %>%
  dplyr::select(dplyr::all_of(target_variables)) %>%
  cor(use = "pairwise.complete.obs") %>%
  as.data.frame()

d_cor_fe_edc <- 
  d %>%
  dplyr::filter(index_edc) %>%
  dplyr::select(dplyr::all_of(target_variables)) %>%
  cor(use = "pairwise.complete.obs") %>%
  as.data.frame()
```

```{r}
## Scatterplots

# prepare data frame
d_el_variables <- 
  d %>%
  dplyr::filter(!is.na(C)) %>%
  dplyr::select(dplyr::all_of(c("site_label", "depth_upper", "C", target_variables, "index_eac", "index_edc"))) %>%
  dplyr::rename(HI = hi3, "C[OX]" = nosc, 'EAC[POM]' = eac_c1, 'EDC[POM]' = edc_c1, 'EDC[POM]:EAC[POM]' = "edc_c1:eac_c1") %>%
  dplyr::mutate(eac_sd = errors::errors(`EAC[POM]`),
                edc_sd = errors::errors(`EDC[POM]`),
                "edc:eac_sd" = errors::errors(`EDC[POM]:EAC[POM]`)) %>%
  dplyr::mutate_if(is.numeric, as.numeric) %>%
  tidyr::pivot_longer(cols = -c(site_label, depth_upper, C, 'EAC[POM]', 'EDC[POM]', "EDC[POM]:EAC[POM]", eac_sd, edc_sd, "edc:eac_sd", index_eac, index_edc), 
                      names_to = "variable", 
                      values_to = "values") %>%
  tidyr::pivot_longer(cols = -c(site_label, depth_upper, C, eac_sd, edc_sd, "edc:eac_sd", variable, values, index_eac, index_edc),
                      names_to = "el_variable", 
                      values_to = "el_values") %>%
  dplyr::mutate(el_sd = ifelse(el_variable == "EAC", eac_sd, ifelse(el_variable == "EDC", edc_sd, `edc:eac_sd`)),
                variable = factor(variable, levels = target_variables_pretty)) %>%
  dplyr::select(-c(eac_sd, edc_sd, "edc:eac_sd")) %>%
  dplyr::mutate(
    index = 
      dplyr::case_when(
        el_variable == "EAC[POM]" ~ index_eac,
        el_variable == "EDC[POM]" ~ index_edc,
        el_variable == "EDC[POM]:EAC[POM]" ~ index_edc & index_eac
      )
  )

# no differentiation between sites, errorbars
p_el_variables1 <- 
  d_el_variables %>%
  ggplot(aes(x = values, y = el_values, ymin = el_values - el_sd, ymax = el_values + el_sd)) + 
  geom_errorbar(width = 0, colour = "grey") +
  geom_point() +
  facet_grid(el_variable ~ variable, labeller = label_parsed, scales = "free") +
  labs(x = "", y = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"] or "*EAC[POM]/EDC[POM])) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.8))

# line for each site, no error bars
p_el_variables2 <- 
  d_el_variables %>%
  ggplot(aes(x = values, y = el_values, ymin = el_values - el_sd, ymax = el_values + el_sd)) + 
  geom_smooth(aes(colour = site_label), method = "lm", se = FALSE) +
  geom_point(aes(colour = site_label)) +
  facet_grid(el_variable ~ variable, labeller = label_parsed, scales = "free") +
  labs(x = "", y = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"] or "*EDC[POM]/EAC[POM])) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.8), 
        legend.position = "bottom")

## the same plot as p_el_variables1 with data filtered for the potential contribution of Fe to the EAC/EDC
p_el_variables1_fe <- 
  d_el_variables %>%
  dplyr::filter(index) %>%
  ggplot(aes(x = values, y = el_values, ymin = el_values - el_sd, ymax = el_values + el_sd)) + 
  geom_errorbar(width = 0, colour = "grey") +
  geom_point() +
  facet_grid(el_variable ~ variable, labeller = label_parsed, scales = "free") +
  labs(x = "", y = expression(EAC[POM]~or~EDC[POM]~"["*mu*mol~g[C]^{-1}*"] or "*EDC[POM]/EAC[POM])) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.8),
        panel.spacing.x = unit(5, "mm"))
```


### Regression Models

```{r regression-settings}
# general settings for regression models
seed <- 1 # random number generator seed
chains <- 4 # no of MCMC chains
warmup <- 500 # warmup MCMC iterations
iter <- 2000 # total MCMC iterations
ci_prob = 0.95 # compatibility interval level
```


```{r regression-elco-child, child="003-paper-regression-elco.Rmd", cache=TRUE, results='hide'}
# get results from child document
```

```{r correlation-spectra}
## correlation between EAC and EDC and spectral variables

# format spectral data
d_mir_cor_eac <- 
  d %>% 
  dplyr::filter(!is.na(C) & index_eac) %>%
  ir::ir_flatten() %>%
  dplyr::select(-1) %>%
  t()

d_mir_cor_edc <- 
  d %>% 
  dplyr::filter(!is.na(C) & index_edc) %>%
  ir::ir_flatten() %>%
  dplyr::select(-1) %>%
  t()

# compute correlation spectra
d_mir_cor <- 
  tibble::tibble(
    x = d$spectra[[1]]$x,
    'EAC[POM]' = 
      cor(d %>%
            dplyr::filter(!is.na(C) & index_eac) %>%
            dplyr::pull(eac_c1), 
          d_mir_cor_eac, 
          use = "pairwise.complete.obs") %>% 
      as.numeric(),
    'EDC[POM]' = 
      cor(d %>%
            dplyr::filter(!is.na(C) & index_edc) %>%
            dplyr::pull(edc_c1),
          d_mir_cor_edc, 
          use = "pairwise.complete.obs") %>% 
      as.numeric()
  ) %>%
  tidyr::pivot_longer(cols = dplyr::all_of(c("EAC[POM]", "EDC[POM]")), 
                      names_to = "variable", 
                      values_to = "values")

# add a reference spectrum
d_mir_cor_ref_spec <- 
  d %>% ir::ir_normalise(method = "zeroone")
d_mir_cor_ref_spec <- 
  d_mir_cor_ref_spec$spectra[[1]] %>%
  dplyr::rename(values = "y") %>%
  dplyr::mutate(variable = "Reference spectrum",
                values = values/3 + 0.7)

# plot
p_mir_cor <- 
  d_mir_cor %>%
  ggplot(aes(y = values, x = x, linetype = variable)) +
  geom_hline(yintercept = 0, colour = "grey") + 
  geom_path() +
  geom_path(data = d_mir_cor_ref_spec, colour = "grey", linetype = 1) +
  labs(x = expression("Wavenumber ["*cm^{-1}*"]"),
       y = "Pearson correlation coefficient") +
  scale_linetype_manual(values = c(1, 2), labels = expression(EAC[POM], EDC[POM])) + 
  guides(linetype = guide_legend(title = "Variable")) +
  theme(legend.position = "bottom")
```

```{r regression-mirs-child, child="004-paper-regression-mirs.Rmd", cache=TRUE, results='hide'}
# get results from child document
```

We used regression models to analyze if peat EAC\textsubscript{POM} and EDC\textsubscript{POM} can be predicted from a linear combination of individual element ratios (H:C, O:C, N:C, S:C). Different regression approaches were investigated: (1) including only the H:C and O:C ratio, and (2) including all four element ratios. We used Bayesian hierarchical models to consider the uncertainties of the replicate measurements and that these were different for different samples (supporting figure \ref{si-fig:p-reg-distogram-res} provides an overview on the model structure). For the EAC\textsubscript{POM} and EDC\textsubscript{POM} values (both individual measurements and replicate measurement averages) we assumed a Gamma distribution with log-link function. Individual replicate measurements with EDC\textsubscript{POM} values $\le \SI{0}{\micro\mol\per\gram\carbon}$ were set to \SI{0}{\micro\mol\per\gram\carbon} for this. Since the absolute values of these measurements is small in comparison to the median EDC\textsubscript{POM} values, we assumed that this causes no bias in our analyses. Further details on the specification of the element ratio-based models can be found in the supporting information.  
Additionally, we computed regression models to analyze the joint relation of molecular structures derived from MIRS to the EAC\textsubscript{POM} and EDC\textsubscript{POM}. For this, we used partial least squares regression (PLSR) and Bayesian regularization [e.g. @Artz.2008; @Ferragina.2015]. Since different preprocessing approaches for MIRS can affect the predictive performance of models [@Engel.2013], we computed not only one regression model for each the EAC\textsubscript{POM} and EDC\textsubscript{POM}, but four, using either non-derived spectra or first derivative spectra as input data, and PLSR or Bayesian regularization, respectively. In addition, for the EDC\textsubscript{POM}, we observed biases and tried to reduce these by dividing the EDC\textsubscript{POM} by HI\textsubscript{1630/1090}.   
We applied Bayesian projection [@Piironen.2020] on all MIRS-based models to facilitate their interpretation. Bayesian projection seeks to find a reduced model that is similar to the full model in terms of its posterior distribution within some defined tolerance threshold [@Piironen.2020]. This allowed us to establish more direct links between the underlying molecular structures and the EAC\textsubscript{POM} and EDC\textsubscript{POM}. Further details on the projection approach are described in the supporting information.  
We also wanted to analyze if regression models using element ratios or mid infrared variables may be used to predict peat EAC\textsubscript{POM} and EDC\textsubscript{POM}. For this, we estimated the predictive accuracy using 10-fold cross-validation (CV) [@Roberts.2017] and the root mean square error (RMSE) as performance metric [@Bellocchi.2010]. As we did not observe large deviations between alternative regression models, we cross-validated only the regression models containing all element ratios (H:C, O:C, N:C, S:C) and the MIRS-based models using Bayesian regularization and non-derived spectra. The RMSE was computed between the MCMC draws for predictions of the regression models for new observations and MCMC draws for estimates of the samples' average EAC\textsubscript{POM} or EDC\textsubscript{POM}, respectively. This allowed us to consider the uncertainties of the repeated measurements during CV, and to compute a probability distribution of the RMSE values based on the CV uncertainty, as well as the models' uncertainties.  

```{r p-y-yhat}
## plot of measured values vs fitted values for the regression models

# get the data
d_y_yhat_tot <- 
  dplyr::bind_rows(
    reg_eac_evaluations_fe[[2]]$m_summary %>%
      dplyr::mutate(target_var = "EAC[POM]",
                    predictors = "Element~ratios"),
    reg_edc_evaluations_fe[[2]]$m_summary %>%
      dplyr::mutate(target_var = "EDC[POM]",
                    predictors = "Element~ratios"),
    cal_eac_br_evaluations_fe$d_cal_eac_fe$m_summary %>%
      dplyr::mutate(target_var = "EAC[POM]",
                    predictors = "MIRS"),
    cal_edc_br_evaluations_fe$d_cal_edc_fe$m_summary %>%
      dplyr::mutate(target_var = "EDC[POM]",
                    predictors = "MIRS")
  )

# plot
p_y_yhat <- 
  ggplot(d_y_yhat_tot, 
         aes(y = y_mean, ymin = y_lwr, ymax = y_upr, 
             x = yhat_mean, xmin = yhat_lwr, xmax = yhat_upr)) + 
  geom_errorbar(colour = "grey") +
  geom_errorbarh(colour = "grey") +
  geom_point() +
  labs(x = expression("Predicted ["*mu*mol~g[C]^{-1}*"]"), 
       y = expression("Measured ["*mu*mol~g[C]^{-1}*"]")) + 
  facet_grid(predictors ~ target_var, scales = "free", labeller = label_parsed) +
  geom_abline(intercept = 0, slope = 1) +
  theme(strip.text.x = element_text(hjust = 0.5),
        strip.text.y = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, vjust = 0.8),
        panel.spacing.x = unit(5, "mm"))
```

# Results

## EAC\textsubscript{POM} and EDC\textsubscript{POM}

Our peat samples' average EAC\textsubscript{POM} ranges between `r round(min(as.numeric(d$eac_c1[d$index_eac]), na.rm = TRUE), 0)` and \SI{`r round(max(as.numeric(d$eac_c1[d$index_eac]), na.rm = TRUE), 0)`}{\micro\mol\per\g\carbon} and their EDC\textsubscript{POM} between `r round(min(as.numeric(d$edc_c1[d$index_edc]), na.rm = TRUE), 0)` and \SI{`r round(max(as.numeric(d$edc_c1[d$index_edc]), na.rm = TRUE), 0)`}{\micro\mol\per\g\carbon} (after filtering; see table \ref{tab:t-ranges-sites} for site-specific values). The EAC\textsubscript{POM} is typically larger than the EDC\textsubscript{POM}, with few exceptions, and both are loosely positively related ($\rho=$ `r round(cor(purrr::map_dbl(reg_base_eac_summary, mean), purrr::map_dbl(reg_base_edc_summary, mean)), 2)`), as shown in figure \ref{fig:p-el-comparison-res} b.  
The EAC\textsubscript{POM} and EDC\textsubscript{POM} vary considerably between different sites and the depth-related within-site variability is also large (figure \ref{fig:p-el-comparison-res} a). In addition, no general depth-related pattern is visible: For some peat cores, the uppermost sample had the largest EAC\textsubscript{POM} or EDC\textsubscript{POM}, for others the deepest, and for some the intermediate samples. The same figure also shows that the EAC\textsubscript{POM} and EDC\textsubscript{POM} can change independently or even inversely to each other along the peat profile. Finally, our specific sites did not show distinct patterns in their EAC\textsubscript{POM} and EDC\textsubscript{POM} to differentiate bogs and fens (supporting figure \ref{si-fig:el-comparison-peatland-types-res}).  
Figure \ref{fig:p-el-comparison-res} C compares EAC\textsubscript{POM} and EDC\textsubscript{POM} for our peat samples to those for different HS and peat DOM samples obtained from different studies [@Aeschbacher.2012; @Tan.2017; @Walpen.2018]. Most HS and peat DOM samples have a clearly larger EAC and EDC, whereby mineral soil HS [@Tan.2017] seem to have intermediate values relative to our measurements on the one side and the larger values for various IHSS reference samples [@Aeschbacher.2012] and peat DOM samples [@Walpen.2018] on the other side.

```{r t-ranges-sites}
# table summarizing key properties of the analyzed peat samples
d_ranges_sites %>%
  dplyr::mutate(site_label = factor(site_label, levels = levels(d$site_label))) %>%
  dplyr::arrange(site_label) %>%
  dplyr::mutate(
    EAC = paste0(round(eac_c_mean, 0), " (", round(eac_c_min, 0),", ", round(eac_c_max, 0),")"),
    EDC = paste0(round(edc_c_mean, 0), " (", round(edc_c_min, 0),", ", round(edc_c_max, 0),")"),
    `H:C` = paste0(round(`H:C_mean`, 2), " (", round(`H:C_min`, 2),", ", round(`H:C_max`, 2),")"),
    `O:C` = paste0(round(`O:C_mean`, 2), " (", round(`O:C_min`, 2),", ", round(`O:C_max`, 2),")"),
    `N:C` = paste0(round(`N:C_mean`, 2), " (", round(`N:C_min`, 2),", ", round(`N:C_max`, 2),")"),
    `S:C` = paste0(round(`S:C_mean`, 3), " (", round(`S:C_min`, 3),", ", round(`S:C_max`, 3),")"),
    nosc = paste0(round(nosc_mean, 2), " (", round(nosc_min, 2),", ", round(nosc_max, 2),")"),
    hi3 = paste0(round(hi3_mean, 2), " (", round(hi3_min, 2),", ", round(hi3_max, 2),")"),
  ) %>%
  dplyr::select(site_label, EAC, EDC, `H:C`, `O:C`, `N:C`, `S:C`, nosc, hi3) %>%
  kableExtra::kable(format = "latex", 
                    booktabs = TRUE, 
                    escape = FALSE, 
                    col.names = c("Site label", "EAC$_\\text{POM}$", "EDC$_\\text{POM}$", "H:C", "O:C", "N:C", "S:C", "C$_\\text{OX}$", "HI$_\\text{1630/1090}$"), 
                    caption = 'Overview on the electrochemical and chemical properties and decomposition states of the peat samples for the different sites (mean, min, max). EAC\\textsubscript{POM} and EDC\\textsubscript{POM} are given in $\\si{\\micro\\mol\\per\\g\\carbon}$. Element ratios are molar ratios. C$_\\text{OX}$ is the nominal oxidation state of carbon. HI$_\\text{1630/1090}$ is the ratio of the intensities at 1630 and $\\SI{1090}{\\wn}$ computed from mid infrared spectra.',
                    align = "lccccccc") %>%
  kableExtra::landscape() %>%
  kableExtra::kable_styling(latex_options = "scale_down")
```

```{r p-el-comparison-res, fig.align='center', fig.height=12, fig.width=8, out.width="0.7\\textwidth", fig.cap="\\textbf{A}: Depth profiles of the EAC\\textsubscript{POM} and EDC\\textsubscript{POM} for each peat core. Thick curves represent the median values of the replicate measurements and horizintal lines the standard error of the replicate measurements. Sites are sorted according to their median EAC\\textsubscript{POM}. The depth is presented log-scaled. Different colours indicate samples for which the potential maximum contribution of iron to the EAC or EDC is larger than $\\SI{100}{\\micro\\mol\\per\\gram\\carbon}$. \\textbf{B}: Plot of the average EAC\\textsubscript{POM} versus the average EDC\\textsubscript{POM}. Error bars represent the respective standard errors from replicate measurements. Samples below the diagonal line have a larger EAC\\textsubscript{POM} than EDC\\textsubscript{POM}. Only samples with a potential contribution of iron to the EAC and EDC $\\le\\SI{100}{\\micro\\mol\\per\\gram\\carbon}$ are shown. \\textbf{C}: Histograms of the EAC and EDC values, respectively, for the peat POM samples analyzed in this study, humic substances, and dissolved organic matter analysed in other studies. Top: Values reported in $\\si{\\micro\\mol\\per\\g\\sample}$. Bottom: Values reported in $\\si{\\micro\\mol\\per\\g\\carbon}$). Only samples with a potential contribution of iron to the EAC and EDC $\\le\\SI{100}{\\micro\\mol\\per\\gram\\carbon}$ are shown."}
cowplot::plot_grid(
  p_el_depth_profiles_fe,
  NULL,
  cowplot::plot_grid(
    p_el_eac_edc_fe,
    cowplot::plot_grid(p_el_comparison_fe, p_el_comparison2_fe, ncol = 1), 
    ncol = 1, labels = letters[2:3], rel_heights = c(1, 1.4)
  ),
  nrow = 1, rel_widths = c(1, 0.07, 1.15), labels = c("a", ""))
```

## Relation to Bulk Chemical Properties

No single bulk chemical property is strongly related to either the EAC\textsubscript{POM}, EDC\textsubscript{POM} or EDC\textsubscript{POM}:EAC\textsubscript{POM} ratio, except for the N:C ratio which is relatively strongly related to the EDC\textsubscript{POM} ($\rho=$ `r round(d_cor_fe_edc["edc_c1", "N:C"], 2)`), and the H:C ratio which is related to the EAC\textsubscript{POM} ($\rho=$ `r round(d_cor_fe_eac["eac_c1", "H:C"], 2)`) (supporting figure \ref{si-fig:p-el-variables1-res}). The EDC\textsubscript{POM}:EAC\textsubscript{POM} ratio is related to the N:C ratio ($\rho=$ `r round(d_cor_fe_edc["edc_c1:eac_c1", "N:C"], 2)`). All other Pearson correlation coefficients between either the EAC\textsubscript{POM} or EDC\textsubscript{POM} and any of the variables we considered is not larger than `r round(max(as.numeric(c(d_cor_fe_eac["eac_c1", -match(c("edc_c1", "eac_c1", "edc_c1:eac_c1", "H:C"), colnames(d_cor_fe_eac))], d_cor_fe_edc["edc_c1", -match(c("edc_c1", "eac_c1", "edc_c1:eac_c1", "N:C"), colnames(d_cor_fe_edc))]))), 2)` or smaller than `r round(min(as.numeric(c(d_cor_fe_eac["eac_c1", -match(c("edc_c1", "eac_c1", "edc_c1:eac_c1", "H:C"), colnames(d_cor_fe_eac))], d_cor_fe_edc["edc_c1", -match(c("edc_c1", "eac_c1", "edc_c1:eac_c1", "N:C"), colnames(d_cor_fe_edc))]))), 2)`.  
The relative weak correlations are not due to non-linear relations, but due to a large variability within and between sites (supporting figure \ref{si-fig:p-el-variables1-res}). For the EAC\textsubscript{POM}, this variability is especially large for samples with average N:C ratio, medium to large O:C ratio, large C$_\text{OX}$, and medium HI$_\text{1630/1090}$. For the EDC\textsubscript{POM}, the variability is large for medium to small O:C ratio, medium to small C$_\text{OX}$, and medium HI$_\text{1630/1090}$. For the EDC\textsubscript{POM}:EAC\textsubscript{POM} ratio, the variability is large for small to medium N:C ratios and HI$_\text{1630/1090}$.  
EAC\textsubscript{POM} and EDC\textsubscript{POM} values are large along a gradient with large O:C and large H:C ratio at the one end and small O:C and small H:C ratio at the other end (figure \ref{fig:p-el-ch-co1-res}). Conversely, samples with small O:C ratio, but large H:C ratio have the smallest EAC\textsubscript{POM} and EDC\textsubscript{POM}. Whilst this gradient is a general pattern, there are some samples with smaller and larger EAC\textsubscript{POM} and EDC\textsubscript{POM} values than could be expected based on the described gradient. For instance the two samples from SKY I-1 at intermediate depth have a surprisingly small EAC\textsubscript{POM} and EDC\textsubscript{POM}, and samples from SKY II and Martinskapelle (MK) have a large EAC\textsubscript{POM} and EDC\textsubscript{POM} for their small O:C and large H:C ratio (figure \ref{fig:p-el-ch-co1-res}).  
To compare these patterns to those for HS, we present the same variables in figure \ref{fig:p-el-ch-co1-res} B, but including various IHSS reference HS and measured EAC and EDC values from @Aeschbacher.2012 for some of these. The H:C values of the HS are separated by ~0.5 from that of the peat samples, whereas there is a rather large overlap in the O:C ratio between both sample groups. One exception is the Pony Lake Fulvic Acid (FA) that has a H:C ratio similar to our peat samples. Overall, the HS samples, with their larger EAC and EDC, extent the gradient we observed for the peat samples.
We additionally labeled regions according to OM fractions typically delineated in van-Krevelen diagrams [@Kim.2003]. The peat samples spread between the cellulose and lignin regions, whereas the HS samples are shifted more towards the lignin region due to their small H:C ratios (except Pony Lake FA) (figure \ref{fig:p-el-ch-co1-res} b).


```{r p-el-ch-co1-res, fig.align='center', fig.height=8.5, fig.width=6, out.width="0.7\\textwidth", fig.cap="Van-Krevelen-like plot for the peat samples analysed in this study. \\textbf{a:} Points are scaled relative to the EAC and EDC, respectively, and coloured accoring to the sites the samples were taken from. \\textbf{b:} The same as a, but including all samples from this study and various IHSS reference humic substances (red and small grey points) in addition to our peat samples (blue points). HS for which Aeschbacher et al. (2012) measured EAC and EDC data are filled red and scaled according to these values. HS for which this was not the case are represented as uniformly small grey points. Moreover, we highlighted regions commonly attributed to different OM fractions in van-Krevelen plots (Kim (2003)). PLFA is the Pony Lake Fulvic Acid reference HS. From this study, only samples with a potential contribution of iron to the EAC and EDC $\\le\\SI{100}{\\micro\\mol\\per\\gram\\carbon}$ are shown and point sizes are scaled relative to the EAC\\textsubscript{POM} and EDC\\textsubscript{POM}, respectively."}
cowplot::plot_grid(
  plotlist = list(p_el_ch_co1_fe, p_el_ch_co2), 
  ncol = 1, 
  rel_heights = c(1, 0.8), 
  labels = letters[1:2]
)
```

This observed gradient is partly also supported by the regression models. 
For the EAC\textsubscript{POM}, the H:C ratio has a negative coefficient ($\beta_\text{H:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.1"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.1"], prob = 0.95), 2)`$]; All reported intervals are 95\%-posterior intervals for the models with all element ratios and Gaussian coefficients, except if stated differently) and the O:C ratio a positive coefficient ($\beta_\text{O:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.2"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.2"], prob = 0.95), 2)`$]) for all models.
For the EDC\textsubscript{POM}, the O:C ratio only has a positive coefficient ($\beta_\text{O:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_edc_evaluations_fe[[1]][["m_pars"]][, "betas.2"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_edc_evaluations_fe[[1]][["m_pars"]][, "betas.2"], prob = 0.95), 2)`$]) if the N:C and S:C ratio are not included, whereas the coefficients' posterior intervals for the H:C ratio broadly overlaps zero ($\beta_\text{H:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_edc_evaluations_fe[[1]][["m_pars"]][, "betas.1"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_edc_evaluations_fe[[1]][["m_pars"]][, "betas.1"], prob = 0.95), 2)`$]). If the N:C and S:C ratio are included in the model, the coefficient for the O:C ratio ($\beta_\text{O:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.2"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.2"], prob = 0.95), 2)`$]) and H:C ratio ($\beta_\text{H:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.1"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.1"], prob = 0.95), 2)`$]) clearly overlap zero.  
For the EAC\textsubscript{POM}, neither the N:C ($\beta_\text{N:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.3"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.3"], prob = 0.95), 2)`$]), nor the S:C ratio ($\beta_\text{S:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.4"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_eac_evaluations_fe[[2]][["m_pars"]][, "betas.4"], prob = 0.95), 2)`$]) have a clearly from zero different coefficient. For the EDC\textsubscript{POM}, the S:C ratio is also not clearly different from zero ($\beta_\text{S:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.4"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.4"], prob = 0.95), 2)`$]), whereas the model implies a negative relation for the N:C ratio ($\beta_\text{N:C}\in$[$`r round(redoxpeat::get_lower_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.3"], prob = 0.95), 2)`, `r round(redoxpeat::get_upper_ci(reg_edc_evaluations_fe[[2]][["m_pars"]][, "betas.3"], prob = 0.95), 2)`$]). Thus, it seems that the EAC\textsubscript{POM} is linearly mainly related to the H:C and O:C ratio, whereas the EDC\textsubscript{POM} is mainly related to the N:C ratio.

## Relation to Molecular Structures

MIR variables typically assigned to labile OM fractions tend to be positively related to the EAC\textsubscript{POM} and EDC\textsubscript{POM} and variables typically assigned to more recalcitrant OM fractions tend to be negatively related to the EAC\textsubscript{POM} and EDC\textsubscript{POM} (supporting figure \ref{si-fig:p-mir-cor-res}). This is evident from positive correlations with MIR variables representing cellulose C-O stretching, phenol C-O stretching and O-H bending, carbonyl C=O stretching, cellulose and phenol O-H stretching and negative correlations with MIR variables representing aromatic C=C stretching, C-H bending, and lipid C-H stretching [@Stuart.2005; @Cocozza.2003; @Artz.2008; @Kubo.2005; @Schmidt.2006]. However, the correlations are overall relatively small (maximum absolute correlation $=`r round(max(abs(d_mir_cor[, "values"])), 2)`$).  
The general patterns in the correlation spectra for the EAC\textsubscript{POM} are similar to those for the EDC\textsubscript{POM}. Some deviations are visible: For example the EDC\textsubscript{POM} has a more negative relation to aromatic C=C stretching, and a more positive relation to cellulose and phenol O-H stretching, whereas the EAC\textsubscript{POM} is more strongly related to carbonyl C=O stretching.  
Variable selection during the regression analysis identified `r cal_br_proj_fe$d_cal_eac_fe$cal_vs_ss` and `r cal_br_proj_fe$d_cal_edc_fe$cal_vs_ss` variables as sufficient to predict the EAC\textsubscript{POM} and EDC\textsubscript{POM}, respectively: The EAC\textsubscript{POM} is positively related to carbonyl group C=O stretching and tends to be negatively related to lipid C-H stretching, O-H stretching of unbonded OH groups, and C-H bending of (potentially polysubstituted) aromatics (table \ref{tab:t-mir-sel}). For lipid C-H stretching and unbonded O-H stretching, two directly neighboring variables with partly contrasting coefficients (positive and negative) were selected. However, their joint relation to the EAC\textsubscript{POM} is clearly negative (supporting figure \ref{si-fig:p-partial-dependence-res}). The EDC\textsubscript{POM} tends to be positively related to O-H stretching of intramoleculary bonded OH groups, probably of cellulose and phenols, and tends to be negatively related to secondary amide N–H bending and C–N stretching (table \ref{tab:t-mir-sel}).  
Overall, this indicates that the EAC\textsubscript{POM} is positively related to carbonyl groups and negatively related to structures more abundant in decomposed peat (lipids, aromatics, unbonded OH groups), and the EDC\textsubscript{POM} is positively related to structures more abundant in undecomposed peat (intramolecular OH bonds in cellulose and phenols).  

```{r t-mir-sel}
# table with selected MIR variables

dplyr::bind_rows(
  cal_br_proj_fe$d_cal_eac_fe$cal_vs_interpretation %>%
    dplyr::mutate(beta_eac = paste0(round(beta_mean, 2), " (", round(beta_lwr, 2), ", ", round(beta_upr, 2),")"),
                  om_fraction = c("Lipid C-H stretching", 
                                  "O-H stretching of unbonded OH groups",
                                  "Lipid C-H stretching",
                                  "C-H bending of di- or trisubstituted aromatics",
                                  "O-H stretching of unbonded OH groups",
                                  "Carbonyl C=O stretching (carboxyls, esters, ketones - aliphatic and aromatic)"),
                  reference = c("\\citet{Cocozza.2003}, \\citet{Stuart.2005}, \\citet{Artz.2008}",
                                "\\citet{Stuart.2005}, \\citet{Kubo.2005}, \\citet{Schmidt.2006}",
                                "\\citet{Cocozza.2003}, \\citet{Stuart.2005}, \\citet{Artz.2008}",
                                "\\citet{Stuart.2005}",
                                "\\citet{Stuart.2005}, \\citet{Kubo.2005}, \\citet{Schmidt.2006}",
                                "\\citet{Cocozza.2003}, \\citet{Stuart.2005}, \\citet{Artz.2008}")),
  cal_br_proj_fe$d_cal_edc_fe$cal_vs_interpretation %>%
    dplyr::mutate(beta_edc = paste0(round(beta_mean, 2), " (", round(beta_lwr, 2), ",", round(beta_upr, 2),")"),
                  om_fraction = c("O-H  stretching of bonded OH groups (cellulose, phenols)", "Secondary amide N–H bending and C–N stretching"), 
                  reference = c("\\citet{Stuart.2005} \\citet{Kubo.2005} \\citet{Schmidt.2006}", "\\citet{Stuart.2005}"))
) %>%
  dplyr::select(wavenumber, beta_eac, beta_edc, om_fraction, reference) %>%
  dplyr::mutate(beta_eac = ifelse(is.na(beta_eac), "", beta_eac),
                beta_edc = ifelse(is.na(beta_edc), "", beta_edc)) %>%
  dplyr::arrange(wavenumber) %>% 
  kableExtra::kable(format = "latex", booktabs = TRUE, 
                    caption = 'Assignment of MIR variables included in the projected regression models for the EAC\\textsubscript{POM} and EDC\\textsubscript{POM} using the filtered data set, respectively. "Wavenumber" represents the average bin position wavenumber value of the MIR variable that were selected. "Coefficient" are the estimated coefficients of the variables (mean and limits of the 95\\% posterior intervals).',
                    col.names = c("Wavenumber", "EAC\\textsubscript{POM}", "EDC\\textsubscript{POM}", "Assigned structure", "Reference"),
                    align = "cllll",
                    escape = FALSE) %>%
  kableExtra::add_header_above(c(" ", "Coefficient" = 2, " ", " ")) %>%
  kableExtra::kable_styling(latex_options = "scale_down") %>%
  kableExtra::column_spec(4, width = "4cm") %>%
  kableExtra::column_spec(5, width = "3cm")
```



## Predictive Accuracy of the MIRS-Based Models in Comparison to Regression Models Based on Element Ratios 

The predictive performances of the different modeling approaches (MIRS-based vs element ratio-based) do not differ considerably and are several times larger than the standard deviation of the distributions for the respective replicate measurements. The MIRS-based models had a median 10-fold CV-RMSE $`r round(abs(median(cal_cv_eac_rmse[, "rmse", drop = TRUE]) - median(reg_cv_eac2_rmse[, "rmse", drop = TRUE])), 1)`$ and $\SI{`r round(abs(median(cal_cv_edc_rmse[, "rmse", drop = TRUE]) - median(reg_cv_edc2_rmse[, "rmse", drop = TRUE])), 1)`}{\micro\mol\per\g\carbon}$ smaller and larger than the element ratio-based models for the EAC\textsubscript{POM} and EDC\textsubscript{POM}, respectively. The models with the least median 10-fold CV-RMSE for each variable had a 10-fold CV-RMSE of `r round(median(cal_cv_eac_rmse$rmse), 1)` [`r round(redoxpeat::get_lower_ci(cal_cv_eac_rmse$rmse, 0.95), 1)`, `r round(redoxpeat::get_upper_ci(cal_cv_eac_rmse$rmse, 0.95), 1)`] and `r round(median(reg_cv_edc2_rmse$rmse), 1)` [`r round(redoxpeat::get_lower_ci(reg_cv_edc2_rmse$rmse, 0.95), 1)`, `r round(redoxpeat::get_upper_ci(reg_cv_edc2_rmse$rmse, 0.95), 1)`] $\si{\micro\mol\per\g\carbon}$ for the EAC\textsubscript{POM} and EDC\textsubscript{POM}, respectively. In comparison to this, the median standard deviation from the estimated distribution for the measured values is `r round(median(purrr::map_dbl(reg_base_eac_summary, sd)), 1)` and $\SI{`r round(median(purrr::map_dbl(reg_base_edc_summary, sd)), 1)`}{\micro\mol\per\g\carbon}$. In spite of the similar predictive performance of both models for the EAC\textsubscript{POM}, the MIRS-based model is clearly less biased than the element ratio-based model, whereas both models for the EDC\textsubscript{POM} are clearly biased (supporting figure \ref{si-fig:p-y-yhat-res}).  
Using derivative spectra, data subsets, or PLSR instead of Bayesian regularization neither yield considerably worse, nor better models in terms of their training predictive accuracy (supporting figure \ref{si-fig:p-cal-elpd-res}). <!--The projected models based on the PLSR reference model comprise more variables than that based on Bayesian regularization for the EAC\textsubscript{POM} (`r sapply(cal_plsr_proj_fe, function(x) x$cal_vs_ss)[[1]]` in comparison to `r sapply(cal_br_proj_fe, function(x) x$cal_vs_ss)[[1]]` for non-derived spectra). For the EDC\textsubscript{POM}, the differences are smaller.-->


# Discussion

To answer how peat chemistry relates to its EAC\textsubscript{POM} and EDC\textsubscript{POM} and how decomposition changes both, we use our results to develop a conceptual model describing how vegetation chemistry and intensity of aerobic decomposition control peat electrochemical properties via the amount of polymeric phenols and quinones.  
The analyzed peat samples cover a globally representative range of mid to high latitude peat properties and degrees of decomposition (table \ref{tab:t-ranges-sites}). The element ratio data are within the ranges reported by several larger compilations of peat chemical properties [@Moore.2018; @Leifeld.2020; @Wang.2015b; @Loisel.2014; @Tipping.2016]. The same is true for C$_\textrm{OX}$ values [@Worrall.2016b; @Moore.2018; @Leifeld.2020]. Overall, we are confident that our findings and interpretations should hold for a broad range of peat materials and thus are generalizable.

## Quinones and Phenols are Main Contributors to Peat EAC\textsubscript{POM} and EDC\textsubscript{POM}

Our results point towards quinones and phenols as main contributors to the EAC\textsubscript{POM} and EDC\textsubscript{POM} of peat, respectively. EAC\textsubscript{POM} and EDC\textsubscript{POM} values are large along a H:C-O:C gradient with large O:C and large H:C ratio at the one end and small O:C and small H:C ratio at the other end (figure \ref{fig:p-el-ch-co1-res}). Based on commonly delineated H:C-O:C regions in van-Krevelen diagrams [@Kim.2003], we assume that this gradient characterizes material rich in polymeric quinones and phenols. This interpretation is also supported by the positive relation to carbonyl groups which are characteristic of polymeric quinones and phenols [@ElMansouri.2007] (supporting figure \ref{si-fig:p-mir-cor-res}). In addition, the more pronounced negative correlation of the EDC\textsubscript{POM} to the N:C ratio in comparison to the EAC\textsubscript{POM} can be explained with the larger susceptibility of phenols towards decomposition in contrast to quinones which are formed by partial oxidation of phenols [@Fenner.2011; @Aeschbacher.2012; @Bolton.2018]. We expected this finding since quinones and phenols have been identified as major contributors to OM EAC and EDC in general [ @Ratasuk.2007; @Aeschbacher.2010; @Aeschbacher.2012].  
We did not find clear relations of the N:C or S:C ratio to the EAC\textsubscript{POM} and EDC\textsubscript{POM} that would point towards a large contribution of non-quinone moieties to the EAC\textsubscript{POM} or EDC\textsubscript{POM}. In fact, the N:C ratio is negatively related to the EDC. A small non-quinone EAC and EDC is in line with the relative small S and N contents of the peat samples and the neutral pH value our measurements were standardized to [@Fimmen.2007; @HernandezMontoya.2012]; non-quinone EAC\textsubscript{POM} and EDC\textsubscript{POM} would likely be larger with smaller pH values [@Fimmen.2007; @HernandezMontoya.2012; @Aeschbacher.2012]. Moreover, it is likely that any relation between the N:C and S:C ratio and non-quinone EAC\textsubscript{POM} and EDC\textsubscript{POM} is confounded by the dependence of these element ratios and the quinone EAC\textsubscript{POM} and EDC\textsubscript{POM} on the degree of decomposition [@Biester.2014] (see below).  

## Vegetation Chemistry and Decomposition Cause the Decoupling of Peat EAC\textsubscript{POM} and EDC\textsubscript{POM}

The decoupling of peat EAC\textsubscript{POM} and EDC\textsubscript{POM} (figure \ref{fig:p-el-comparison-res} b) can be explained by the joint effects of vegetation polymeric phenol contents and transformation of phenols to quinones during decomposition [@Aeschbacher.2012]. It has been suggested that undecomposed plant-derived polymeric aromatics, such as lignin, have large contents of phenols, but small contents of quinones, which results in an initially large EDC, but small EAC [@Aeschbacher.2012]. Decomposition and oxidation of the polymeric phenols decrease their fraction, but can increase the relative (and absolute) amount of quinones [@Aeschbacher.2012; @Bolton.2018; @LaCroix.2020]. These mechanisms have four important implications: First, undecomposed samples have a maximum EDC, second, this maximum EDC varies depending on the vegetation polymeric phenol content, third, decomposition of polymeric phenols decreases the EDC and increases the EAC [@Aeschbacher.2012], and fourth, the initial EDC defines the maximum potential EAC of a sample. This explains why a decoupling of the EAC and EDC can be observed for HS and DOM [@Aeschbacher.2012]. Our measurements fit into the EDC-EAC gradient observed for HS and DOM (supporting figure \ref{si-fig:p-el-eac-edc2-res}) and we therefore conclude that the decoupling of peat EAC\textsubscript{POM} and EDC\textsubscript{POM} is caused by the same mechanisms.  

## The Degree of Decomposition Confounds How the H:C ratio Represents Phenols and Quinones

In contrast to @Aeschbacher.2012, we found only a weak relation between the EAC\textsubscript{POM} and the H:C ratio. In @Aeschbacher.2012, a large H:C ratio indicates a smaller polymeric phenol and quinone content, but also a larger polysaccharide content because the H:C ratio is related to the O:C ratio (figure \ref{fig:p-el-ch-co1-res}). In contrast, for our peat POM samples, a large H:C ratio is not indicative for a larger polysaccharide content because it could also represent strongly decomposed samples with high lipid content (figure \ref{fig:p-el-ch-co1-res} a). This confounds how the H:C ratio represents polymeric phenols and quinones because peat samples with the same large H:C ratio tend to have a smaller EAC\textsubscript{POM} if they contain a larger amount of lipids and smaller amount of polysaccharides (smaller O:C ratio). This indicates that strongly decomposed, lipid rich, peat has fewer polymeric phenols and quinones than undecomposed peat. In other terms, for the peat POM samples, the same H:C ratio can represent samples with either large O:C ratio or small O:C ratio, corresponding either to relatively undecomposed samples rich in polysaccharides and phenols and quinones or to strongly decomposed samples rich in lipids, but depleted in phenols and quinones [@Kim.2003; @Leifeld.2012; @Bader.2018]. This interpretation is also supported by the joint relation of the H:C and O:C ratio to the EAC\textsubscript{POM} in our regression models and by negative coefficients for MIRS variables representing lipids (table \ref{tab:t-mir-sel}, supporting figure \ref{si-fig:p-mir-cor-res}). Thus, since differences in the O:C ratio are linked to differences in the EAC\textsubscript{POM}, and since such samples are present within our data set, we found a weaker relation of the EAC\textsubscript{POM} to the H:C ratio. It is likely that the same pattern caused the relative weak relation @Tan.2017 observed for the EAC of HS to the H:C ratio.

## Decomposition indicators are poorly related to phenols and quinones

We argue that many peat decomposition indicators are only weakly related to the EAC\textsubscript{POM} and EDC\textsubscript{POM} because they are no optimal descriptors of the polymeric phenol and quinone content. The O:C ratio is an indicator of the polysaccharide content and strongly related to all other decomposition indicators we analyzed (Pearson correlations of the O:C ratio with the N:C ratio, HI\textsubscript{1630/1090}, and C\textsubscript{OX} are `r round(d_cor["O:C", "N:C"], 2)`, `r round(d_cor["O:C", "hi3"], 2)`, and `r round(d_cor["O:C", "nosc"], 2)`, respectively). If we focus on how these indicators describe the degree of decomposition, there is the same confounding as described above, but viewed from a different perspective: for strongly decomposed peat (small O:C ratio), the indicators cannot distinguish between peat with large content of polymeric quinones and phenols on the one side (small H:C ratio) and strongly decomposed peat rich in lipids, but depleted in phenols and quinones (large H:C ratio). For this reason, the EAC\textsubscript{POM} can vary considerably across a broad range of HI$_\text{1630/1090}$ and N:C ratios, as observed in our peat samples (supporting figure \ref{si-fig:p-el-variables1-res}).  
For the EDC\textsubscript{POM}, this confounding effect is less relevant since the EDC\textsubscript{POM} is negatively affected by decomposition, irrespective if the resulting peat is rich in lipids or polymeric quinones, as mentioned above [@Fenner.2011; @Bolton.2018]. This is evident from the stronger relation of the EDC\textsubscript{POM} to the N:C ratio ($\rho=`r round(d_cor["edc_c1", "N:C"], 2)`$). Nevertheless, since samples with a small O:C ratio that are rich in polymeric quinones and phenols have a larger EDC\textsubscript{POM}, and since the HI$_\text{1630/1090}$ and C$_\text{OX}$ do separate these samples less clearly from the lipid rich samples than the N:C ratio (supporting figure \ref{si-fig:p-el-variables1-res}), the relation of both the HI$_\text{1630/1090}$ and C$_\text{OX}$ is also weak for the EDC\textsubscript{POM}.

## Which Factors Determine the Polymeric Phenol and Quinone Content of Decomposed POM?

Which factors determine if a sample with a larger degree of decomposition is either rich in polymeric quinones and phenols --- thus having a larger EAC\textsubscript{POM} and EDC\textsubscript{POM} --- or rich in lipids --- thus having the minimal EAC\textsubscript{POM} and EDC\textsubscript{POM}? Both, differences in vegetation chemistry and decomposition, may result in the observed differences in lipid versus polymeric quinone and phenol content.  
Even though we cannot definitely disentangle both factors based on our data --- we neither have complete information about the peat forming vegetation, nor the actual predominant decomposition processes --- there is some evidence how both contribute. First of all, the samples with the smallest H:C ratio probably contain larger amounts of wood and root remains from trees and shrubs (e.g. both Lutose sites, especially the deepest samples [@Heffernan.2020]; P. Brunswick [@Broder.2012]; Mer Bleue, deepest sample [@Elliott.2012]) which is a plausible explanation for their large EAC\textsubscript{POM}. In contrast, samples with approximately the same O:C ratio, but a larger H:C ratio are probably formed by sedges and (minerotrophic) *Sphagnum* mosses (samples from both both fen sites (Touxi, Dongtu), or from the two Patagonian bogs SKY I-1 and SKY I-6) and likely strongly decomposed (Touxi, Dongtu) or known to be strongly decomposed (Both SKY I sites and SKY II, @Broder.2012, @Mathijssen.2019). Second, intense aerobic decomposition of peat under drainage results in a larger H:C ratio, whereas less oxic conditions result in a decrease of the H:C ratio during decomposition [@Leifeld.2012]. A plausible and likely explanation therefore is that aerobic decomposition of POM initially rich in polymeric phenols results in a large amount of quinones and therefore a large EAC\textsubscript{POM}, whereas *intense* aerobic decomposition of POM that already had small initial amounts of polymeric phenols results in a large relative amount of lipids. Conversely, anaerobic decomposition may conserve initial polymeric phenols and quinones and thus EAC\textsubscript{POM} and EDC\textsubscript{POM} (see below). This means that both vegetation chemistry and intensity of aerobic decomposition contribute to the observed pattern.

## Differential Effects of Decomposition on Peat EAC\textsubscript{POM}

The hypothesis that vegetation chemistry and decomposition intensity together change peat phenols and quinone content can help resolving the apparent contradiction we have produced: Partial oxidation of phenols to quinones during decomposition increases the EAC\textsubscript{POM} [@Aeschbacher.2012; @Walpen.2018; @Tan.2017], but typical MIRS-derived decomposition indicators such as the amount of lipids, unbonded OH groups, and aromatic backbone structures [@Cocozza.2003; @Artz.2008] are negatively related to the EAC\textsubscript{POM} (table \ref{tab:t-mir-sel}). According to our conceptual understanding, the contradiction is only apparent: Aerobic decomposition of POM initially rich in polymeric phenols and quinones increases the amount of quinones [@Aeschbacher.2012], as indicated by larger amounts of carbonyl groups (table \ref{tab:t-mir-sel}). Intense aerobic decomposition of POM with initially low amounts of polymeric phenols and quinones (and hence larger amounts of polysaccharides) results in the mineralization of polysaccharides, phenols and quinones and the accumulation of lipids [@Fenner.2011; @Leifeld.2012]. Thus, if a specific peat contains large amounts of lipids and has an amorphous structure, this indicates that it also contains low amounts of polymeric phenols and quinones because it experienced intense decomposition.

## A conceptual model for peat EAC\textsubscript{POM} and EDC\textsubscript{POM}

To summarize our findings, we propose the conceptual model shown in figure \ref{fig:conceptual1}. We hypothesize that both the polymeric phenol content of the peat forming vegetation and the intensity of decomposition processes are the most important factors controlling the EDC\textsubscript{POM} and EAC\textsubscript{POM} of peat. Moreover, both factors likely interact since peat with initially large amounts of polymeric phenols has a smaller decomposition rate [@Bengtsson.2018].  
Wood and roots from trees and shrubs are probably the plant remains with the largest fraction of polymeric phenols [@Benner.1984; @Williams.1998; @Strakova.2010; @Hodgkins.2018], whereas other vascular plants and mosses have variable and partly smaller amounts of polymeric phenols [@Williams.1998; @Scheffer.2001; @Strakova.2010; @Bengtsson.2018; @Zak.2019]. For this reason, peat with larger contributions of wood or roots e.g. from shrubs (and potentially some graminoid or moss species) likely has the largest initial EDC\textsubscript{POM} and upon decomposition the largest potential EAC\textsubscript{POM} (figure \ref{fig:conceptual1} and supporting figure \ref{si-fig:conceptual2}). We propose that standardized measurements of electrochemical properties for different peat forming species are required to provide a quantitative basis for this hypothesis.  
Under anoxic conditions, low phenol oxidase activities and the effects this has on other enzymes required for biomass breakdown [@Fenner.2011] make peat material keep its initial EDC\textsubscript{POM} and EAC\textsubscript{POM}. In addition, quinone formation by partial oxidation is limited under such conditions, such that the EDC\textsubscript{POM} should be relative large, whereas the EAC\textsubscript{POM} remains smaller (figure \ref{fig:conceptual1} and supporting figure \ref{si-fig:conceptual2}). A factor that may decrease both the EAC\textsubscript{POM} and EDC\textsubscript{POM} under such conditions are condensation reactions [@Hotta.2002; @Uchimiya.2009; @Bolton.2018; @Zhao.2020; @Olk.2006; @Heitmann.2006; @Yu.2016]. Conversely, faster degradation of polysaccharides may increase the EAC\textsubscript{POM} and EDC\textsubscript{POM} since this results in a relative increase of phenols and quinones [@Benner.1984]. However, it remains currently unclear to which extent both factors may play a role under anoxic conditions.
Thus, we assume that under anoxic conditions the initial vegetation properties largely control peat electrochemical properties.  
Under oxic conditions, increased phenol oxidase activities result in an oxidative transformation of polymeric phenols to quinones [@Fenner.2011; @Schellekens.2015; @Bolton.2018]. This can increase the EAC\textsubscript{POM} and decrease the EDC\textsubscript{POM}. If under these oxic conditions e.g. large temperatures, large concentrations of nutrients, large amounts of labile OM, high pH values, or other factors further facilitate the mineralization of polymeric phenols [@Bragazza.2007; @Fenner.2011; @Kang.2018c; @Bowring.2020], coupling reactions [@Hotta.2002; @Johnson.2015; @Bolton.2018; @Zhao.2020], and other condensation reactions [@Bolton.2018; @Olk.2006; @Heitmann.2006; @Yu.2016], both the EAC\textsubscript{POM} and EDC\textsubscript{POM} may decrease (figure \ref{fig:conceptual1} and supporting figure \ref{si-fig:conceptual2}). Intense break-down of cell wall structures (as implied by our regression models for the EDC\textsubscript{POM} and EAC\textsubscript{POM}) may has an important role since it increases the surface of the polymeric phenols exposed for oxidation or condensation reactions [@Tsuneda.2001]. Just as under anoxic conditions, a decrease in the EAC\textsubscript{POM} and EDC\textsubscript{POM} may be offset by faster mineralization of polysaccharides than polymeric phenols [@Benner.1984]. However, again it remains currently unclear to which extent this factor and also condensation reactions play a role. Thus, we assume that oxic conditions increase the EAC\textsubscript{POM} at the expense of the EDC\textsubscript{POM}. The initial content of polymeric phenols defines the maximum EAC\textsubscript{POM} peat can attain throughout this process which results in variable responses of the peat EAC\textsubscript{POM} and EDC\textsubscript{POM} to decomposition. Intense aerobic decomposition, especially of material with low initial amounts of polymeric phenols, may even decrease the EAC due to mineralization and condensation of polymeric phenols.  

```{r conceptual1, fig.align='center', out.width="100%", fig.cap='Conceptual description of the assumed effects of vegetation chemistry (polymeric phenol content) and decomposition pathways and intensity on peat chemistry and its EAC and EDC. Note that the assignment of plant taxa and their polymeric phenol contents is only an example as the chemical properties may be highly diverse within taxa \\citet{Bengtsson.2018}.'}
knitr::include_graphics("./../figures/conceptual_vegetation_decomposition1.pdf")
```

## MIRS-Based Regression Models can Predict Peat EAC\textsubscript{POM}

We suggest that our modeling approach is a proof-of-concept that peat EAC\textsubscript{POM} can be predicted from MIRS. The MIRS-based model had the smallest average RMSE, albeit the RMSE for both the MIRS-based model and the element ratio-based model were relatively large and their 95%-posterior intervals broad and strongly overlapping. During graphical model validation, we observed that the element ratio-based model had a considerably larger bias than the MIRS-based model (supporting figure \ref{si-fig:p-y-yhat-res}), suggesting that the MIRS-based model overall is more robust.  
In contrast to this, both element ratio-based and MIRS-based regression models failed to adequately capture the variability in the EDC\textsubscript{POM}. Since the EDC\textsubscript{POM} of our samples in their oxidized state was smaller, the relative large predictive uncertainties turn both models unsuitable for practical applications.

# Conclusions

Our research question was how peat chemistry relates to its EAC\textsubscript{POM} and EDC\textsubscript{POM} and how decomposition changes both. Based on our results, we hypothesize a conceptual model that describes how vegetation chemistry and intensity of aerobic decomposition control peat EAC\textsubscript{POM} and EDC\textsubscript{POM}. Undecomposed peat formed by vegetation rich in polymeric phenols has the largest EDC\textsubscript{POM}. Decomposition of such material results in peat with the largest EAC\textsubscript{POM}, but decreases the EDC\textsubscript{POM}. In contrast, peat formed by vegetation with small amounts of polymeric phenols generally has a smaller EAC\textsubscript{POM} and EDC\textsubscript{POM}. Especially for such material, intense decomposition not only decreases the EDC\textsubscript{POM}, but potentially also the EAC\textsubscript{POM}. This model can plausibly explain the large variability in the relation of the EAC\textsubscript{POM} and EDC\textsubscript{POM} to peat chemical properties, decomposition indicators, and molecular structures, as well as the high intra-site variability and decoupling of the EAC\textsubscript{POM} and EDC\textsubscript{POM}.
Finally, we provide a proof-of-concept that MIRS-based regression models may be at least suitable as screening tools to predict peat EAC\textsubscript{POM}.  
Our study has four inherent limitations: First, it is difficult to completely exclude contributions of iron to our estimates for the EAC\textsubscript{POM} and EDC\textsubscript{POM}.Second, we derived our conceptual understanding on purely observational data without experimental control. Third, we had only limited data on palaeovegetation and thus could only partly establish direct links between vegetation and peat chemistry.  
Nevertheless, our results imply that peat EAC\textsubscript{POM} and EDC\textsubscript{POM} can be spatially and temporally highly variable and that it is difficult to predict based on peat bulk properties. This furthermore implies that the potential for CH$_4$ suppression due to POM reduction may be similarly variable and difficult to predict.  
Therefore, spatially resolved measurements or the incorporation of our hypothesized conceptual understanding into process models are required for the accurate quantification of peat EAC\textsubscript{POM} and EDC\textsubscript{POM} and their potential effects on redox processes, particularly CH$_4$ formation.

# Open Research {.unnumbered}

Data and code to reproduce this document are available as research compendium on Zenodo and GitHub [--- todo: add link to GitHub repo, add Zenodo DOI, add citation, add license]. In addition, the MIRS-based reference models based on Bayesian regularization for both the EAC\textsubscript{POM} and EDC\textsubscript{POM} are available via the R package irpeat [@Teickner.2020b]. These models can be used for predictions with own MIRS data. [For review purposes, the reproducible research compendium including all necessary data and code to reproduce the findings presented in the manuscript can be found at the following link: https://uni-muenster.sciebo.de/s/SbbFgA8pOI4JKW9]

# Author contributions {.unnumbered}
HT (conceptualization, data curation, formal analysis, investigation, methodology, software, validation, visualization, writing - original draft, writing – review & editing). CG (conceptualization, investigation, methodology, writing – review & editing), KHK (conceptualization, funding acquisition, methodology, project administration, resources, supervision, writing - original draft, writing – review & editing).

# Acknowledgements {.unnumbered}

For their support during sample collection/provision, we would like to thank Svenja Agethen (DE), Werner Borken (SKY I-1, SKY I-6), Tanja Broder (PBR, SKY II, LT, MK), Mariusz Gałka (LT, MK), Liam Heffernan (LP, LB), Norbert Hölzel (KR, ISH), Annkathrain Hömberg (TX, DT), Tim Moore (MB), Sindy Wagner (BB), Tim-Martin Wertebach (KR, ISH), and Zhi-Guo Yu (TX, DT).  
Analyses of this study were carried out in the laboratory of the Institute of Landscape Ecology. Svenja Agethen and Michael Sander provided analytical support. The assistance of  Ulrike Berning-Mader, Madeleine Supper, Victoria Ratachin, and numerous student assistants is greatly acknowledged. We thank Dr. Hendrik Wetzel, Fraunhofer Institute for Applied Polymer Research, Dept. Starch Modification/Molecular Properties, Potsdam, Germany, for analysis of O and H. The workflow was reproduced by the Reproducible Research Support Service of the University of Münster.  
This Study was funded by the Deutsche Forschungsgemeinschaft (DFG, German Research Foundation) grant no. KN 929/12-1 to Klaus-Holger Knorr; Chuanyu Gao was supported by the Youth Innovation Promotion Association CAS (No. 2020235).

```{r supporting-info, include=FALSE, warning=FALSE}
rmarkdown::render("006-paper-supplementary.Rmd", clean = FALSE)
```

```{r references-preparation}
# get bibkeys
bibkeys <- bib2df::bib2df("references.bib")

# get texts to search for bibkey
si_text <- 
  readLines("006-paper-supplementary.Rmd") %>%
  paste(collapse = " ")
  
main_text <- 
  readLines("001-paper-main.Rmd") %>%
  paste(collapse = " ")

bibkeys <-
  bibkeys %>%
  dplyr::mutate(
    refs_only_si = 
      purrr::map_lgl(BIBTEXKEY, function(x) {
        stringr::str_detect(si_text, x) & !stringr::str_detect(main_text, x)
      })
  )
```

\nocite{`r paste(bibkeys$BIBTEXKEY[!bibkeys$refs_only_si], collapse = ", ")`}
\bibliography{references}

\nocitesi{`r paste(bibkeys$BIBTEXKEY[bibkeys$refs_only_si], collapse = ", ")`}
\bibliographystylesi{apacite}
\bibliographysi{references}
